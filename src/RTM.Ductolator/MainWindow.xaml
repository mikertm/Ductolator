<Window
    x:Class="RTM.Ductolator.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Super Ductolator &amp; Plumbing Sizer"
    Width="1000"
    Height="750"
    Background="{StaticResource Brush.AppBackground}"
    Closing="MainWindow_Closing"
    WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <Style
            x:Key="CompactInputTextBox"
            BasedOn="{StaticResource {x:Type TextBox}}"
            TargetType="TextBox">
            <Setter Property="Padding" Value="6,4" />
            <Setter Property="MinHeight" Value="28" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{StaticResource Brush.Border}" />
            <Setter Property="Background" Value="{StaticResource Brush.InputBackground}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border
                            x:Name="border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4"
                            SnapsToDevicePixels="True">
                            <ScrollViewer
                                x:Name="PART_ContentHost"
                                Focusable="false"
                                HorizontalScrollBarVisibility="Hidden"
                                VerticalScrollBarVisibility="Hidden" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter TargetName="border" Property="Opacity" Value="0.56" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource Brush.Accent}" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource Brush.Accent}" />
                                <Setter TargetName="border" Property="BorderThickness" Value="2" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style
            x:Key="CompactOutputTextBox"
            BasedOn="{StaticResource CompactInputTextBox}"
            TargetType="TextBox">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="IsReadOnly" Value="True" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0,0,0,1" />
            <Setter Property="BorderBrush" Value="{StaticResource Brush.BorderMuted}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border
                            x:Name="border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            SnapsToDevicePixels="True">
                            <ScrollViewer
                                x:Name="PART_ContentHost"
                                Focusable="false"
                                HorizontalScrollBarVisibility="Hidden"
                                VerticalScrollBarVisibility="Hidden" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="UnitLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Foreground" Value="{StaticResource Brush.TextSubtle}" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Margin" Value="4,0,0,0" />
        </Style>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Brush.SurfaceAlt}" />
            <Setter Property="BorderBrush" Value="{StaticResource Brush.Border}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="10" />
            <Setter Property="Margin" Value="0,0,0,8" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect
                        BlurRadius="8"
                        Direction="270"
                        Opacity="0.05"
                        ShadowDepth="2" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style
            x:Key="SuccessCardStyle"
            BasedOn="{StaticResource CardStyle}"
            TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Brush.SuccessBackground}" />
            <Setter Property="BorderBrush" Value="#B8E6C5" />
        </Style>

        <Style
            x:Key="WarningCardStyle"
            BasedOn="{StaticResource CardStyle}"
            TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Brush.WarningBackground}" />
            <Setter Property="BorderBrush" Value="#F3CFAA" />
        </Style>

        <Style
            x:Key="AccentCardStyle"
            BasedOn="{StaticResource CardStyle}"
            TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Brush.EmphasisBackground}" />
            <Setter Property="BorderBrush" Value="{StaticResource Brush.BorderAlt}" />
        </Style>
    </Window.Resources>
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
            FontSize="14"
            FontWeight="Bold"
            Text="ASHRAE/SMACNA duct sizing and ASPE/UPC plumbing calculations" />

        <Border
            Grid.Row="1"
            Margin="0,6,0,4"
            Padding="6"
            Background="{StaticResource Brush.SurfaceAlt}"
            BorderBrush="{StaticResource Brush.BorderMuted}"
            BorderThickness="1"
            CornerRadius="6">
            <DockPanel LastChildFill="False">
                <StackPanel
                    VerticalAlignment="Center"
                    DockPanel.Dock="Left"
                    Orientation="Vertical">
                    <TextBlock
                        FontSize="12"
                        FontWeight="SemiBold"
                        Text="Catalog source" />
                    <TextBlock
                        Name="CatalogStatusSummary"
                        FontSize="11"
                        Foreground="{StaticResource Brush.TextSubtle}"
                        TextWrapping="Wrap" />
                </StackPanel>
                <Button
                    MinWidth="140"
                    HorizontalAlignment="Right"
                    Click="OpenCatalogSettings_Click"
                    Content="Manage catalogs"
                    DockPanel.Dock="Right"
                    Style="{StaticResource BaseButtonStyle}" />
            </DockPanel>
        </Border>

        <TabControl
            x:Name="MainTabs"
            Grid.Row="2"
            Margin="0,8,0,0">
            <TabItem Header="Duct Sizing">
                <Grid Margin="6">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*" />
                        <ColumnDefinition Width="2.5*" />
                    </Grid.ColumnDefinitions>

                    <Border
                        Grid.Row="0"
                        Grid.ColumnSpan="2"
                        Margin="2"
                        Padding="8"
                        Style="{StaticResource SuccessBorderStyle}">
                        <StackPanel>
                            <TextBlock FontWeight="Bold" Text="How to use" />
                            <TextBlock
                                x:Name="HowToUseStep1"
                                FontSize="12"
                                Text="1) Enter any two of flow, velocity, or friction plus one geometry (round or rectangular) to solve the rest."
                                TextWrapping="Wrap" />
                            <TextBlock
                                x:Name="HowToUseStep2"
                                FontSize="12"
                                Text="2) Choose a code region to pull in common velocity and friction guidance."
                                TextWrapping="Wrap" />
                            <TextBlock
                                x:Name="HowToUseStep3"
                                FontSize="12"
                                Text="3) Click Calculate to fill air properties, pressure class, and equivalent shapes; Export saves the latest result to CSV."
                                TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>

                    <ScrollViewer
                        Grid.Row="1"
                        Grid.Column="0"
                        Margin="0,6,4,0"
                        Padding="2"
                        HorizontalContentAlignment="Stretch"
                        HorizontalScrollBarVisibility="Disabled"
                        PanningMode="VerticalOnly"
                        VerticalScrollBarVisibility="Auto">
                        <Border
                            Padding="8"
                            Background="{StaticResource Brush.SurfaceAlt}"
                            BorderBrush="{StaticResource Brush.Border}"
                            BorderThickness="1"
                            CornerRadius="8">
                            <StackPanel
                                VerticalAlignment="Stretch"
                                Panel.ZIndex="1"
                                Orientation="Vertical">
                                <TextBlock
                                    Margin="0,0,0,6"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Text="Plan" />

                                <Border
                                    Margin="0,0,0,8"
                                    Padding="6"
                                    Background="{StaticResource Brush.EmphasisBackground}"
                                    BorderBrush="{StaticResource Brush.BorderAlt}"
                                    BorderThickness="1"
                                    CornerRadius="6">
                                    <StackPanel Orientation="Vertical">
                                        <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                            <Button
                                                Name="BtnCalc"
                                                Width="120"
                                                Margin="0,0,8,0"
                                                Click="BtnCalc_Click"
                                                Content="Calculate"
                                                Style="{StaticResource PrimaryButtonStyle}" />
                                            <Button
                                                Name="BtnClear"
                                                Width="90"
                                                Margin="0,0,8,0"
                                                Click="BtnClear_Click"
                                                Content="Clear" />
                                            <Button
                                                Name="BtnExportDuct"
                                                Width="150"
                                                Click="BtnExportDuct_Click"
                                                Content="Export to CSV" />
                                        </StackPanel>
                                        <TextBlock
                                            Margin="2,6,0,0"
                                            FontSize="11"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Quick actions stay here so you don't have to scroll after entering inputs." />
                                    </StackPanel>
                                </Border>

                                <Border
                                    Margin="0,0,0,8"
                                    Padding="6"
                                    Style="{StaticResource HighlightBorderStyle}">
                                    <Expander IsExpanded="True">
                                        <Expander.Header>
                                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                <TextBlock VerticalAlignment="Center" Text="Quick start" />
                                                <CheckBox
                                                    x:Name="NoviceModeToggle"
                                                    Margin="12,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Checked="NoviceModeToggle_Checked"
                                                    Content="Novice mode"
                                                    Unchecked="NoviceModeToggle_Unchecked" />
                                            </StackPanel>
                                        </Expander.Header>
                                        <StackPanel
                                            Margin="0,2,0,0"
                                            Panel.ZIndex="1"
                                            Orientation="Vertical">
                                            <StackPanel.Resources>
                                                <Style BasedOn="{StaticResource CompactInputTextBox}" TargetType="TextBox" />
                                            </StackPanel.Resources>
                                            <TextBlock
                                                x:Name="QuickStartNoteText"
                                                Margin="0,2,0,8"
                                                FontSize="12"
                                                Text="Use this for typical sizing: enter any two of flow, velocity, or friction plus one shape (round or rectangular) to solve the rest."
                                                TextWrapping="Wrap" />
                                            <Grid Margin="0,0,0,6">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="24" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <!--  Airflow Parameters  -->
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock
                                                        Margin="0,0,0,8"
                                                        FontWeight="SemiBold"
                                                        Foreground="{StaticResource Brush.Accent}"
                                                        Text="Airflow Parameters" />

                                                    <Grid Margin="0,0,0,12">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock x:Name="FlowLabel" Text="Flow Rate" />
                                                            <TextBox Name="InCfm" ToolTip="Cubic feet per minute (ft³/min)" />
                                                            <TextBlock
                                                                x:Name="FlowExample"
                                                                FontSize="11"
                                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                                Text="Office branch: ~1,000 cfm" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Style="{StaticResource UnitLabelStyle}"
                                                            Text="CFM" />
                                                    </Grid>

                                                    <Grid Margin="0,0,0,12">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock x:Name="VelocityLabel" Text="Velocity" />
                                                            <TextBox Name="InVel" ToolTip="Feet per minute; common supply 800–1800 fpm" />
                                                            <TextBlock
                                                                x:Name="VelocityExample"
                                                                FontSize="11"
                                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                                Text="Typical supply: 800–1800 ft/min" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Style="{StaticResource UnitLabelStyle}"
                                                            Text="FPM" />
                                                    </Grid>

                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock x:Name="FrictionLabel" Text="Friction Rate" />
                                                            <TextBox Name="InDp100" ToolTip="Inches of water per 100 ft" />
                                                            <TextBlock
                                                                x:Name="FrictionExample"
                                                                FontSize="11"
                                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                                Text="Aim for 0.05–0.08 in. drop per 100 ft" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Style="{StaticResource UnitLabelStyle}"
                                                            Text="in. w.g./100'" />
                                                    </Grid>
                                                </StackPanel>

                                                <!--  Divider  -->
                                                <Rectangle
                                                    Grid.Column="1"
                                                    Width="1"
                                                    Margin="0,4"
                                                    HorizontalAlignment="Center"
                                                    Fill="{StaticResource Brush.BorderMuted}" />

                                                <!--  Geometry Parameters  -->
                                                <StackPanel Grid.Column="2">
                                                    <TextBlock
                                                        Margin="0,0,0,8"
                                                        FontWeight="SemiBold"
                                                        Foreground="{StaticResource Brush.Accent}"
                                                        Text="Geometry Parameters" />

                                                    <Grid Margin="0,0,0,12">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock x:Name="RoundDiameterLabel" Text="Round Diameter" />
                                                            <TextBox Name="InDia" ToolTip="Inside diameter in inches" />
                                                            <TextBlock
                                                                x:Name="RoundDiameterExample"
                                                                FontSize="11"
                                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                                Text="Example: 18 in round main" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Style="{StaticResource UnitLabelStyle}"
                                                            Text="in" />
                                                    </Grid>

                                                    <Grid Margin="0,0,0,12">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock x:Name="RectSide1Label" Text="Rect Side 1" />
                                                            <TextBox Name="InS1" ToolTip="Long side in inches" />
                                                            <TextBlock
                                                                x:Name="RectSide1Example"
                                                                FontSize="11"
                                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                                Text="Example: 24 in long side" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Style="{StaticResource UnitLabelStyle}"
                                                            Text="in" />
                                                    </Grid>

                                                    <Grid Margin="0,0,0,12">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock x:Name="RectSide2Label" Text="Rect Side 2" />
                                                            <TextBox Name="InS2" ToolTip="Short side in inches" />
                                                            <TextBlock
                                                                x:Name="RectSide2Example"
                                                                FontSize="11"
                                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                                Text="Example: 12 in short side" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Style="{StaticResource UnitLabelStyle}"
                                                            Text="in" />
                                                    </Grid>

                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock x:Name="AspectRatioLabel" Text="Aspect Ratio" />
                                                            <TextBox Name="InAR" ToolTip="Dimensionless; use ≥1" />
                                                            <TextBlock
                                                                x:Name="AspectRatioExample"
                                                                FontSize="11"
                                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                                Text="Keep it at 4:1 or lower" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Style="{StaticResource UnitLabelStyle}"
                                                            Text=":1" />
                                                    </Grid>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Expander>
                                </Border>

                                <Border
                                    Margin="0,0,0,8"
                                    Padding="6"
                                    Style="{StaticResource AccentBorderStyle}">
                                    <Expander Header="Advanced" IsExpanded="False">
                                        <StackPanel Margin="0,2,0,0" Orientation="Vertical">
                                            <TextBlock
                                                Margin="0,2,0,8"
                                                FontSize="12"
                                                Text="Use when you need site-specific corrections, leakage pressure class inputs, or thermal/insulation checks."
                                                TextWrapping="Wrap" />
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="2*" />
                                                    <ColumnDefinition Width="2*" />
                                                    <ColumnDefinition Width="2*" />
                                                    <ColumnDefinition Width="2*" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>

                                                <StackPanel
                                                    Grid.Row="0"
                                                    Grid.Column="0"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Air Temp (°F)" />
                                                    <TextBox Name="InAirTemp" ToolTip="Dry-bulb air temperature in °F; used for density/viscosity" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="0"
                                                    Grid.Column="1"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Altitude (ft)" />
                                                    <TextBox Name="InAltitude" ToolTip="Site elevation above sea level in feet" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="0"
                                                    Grid.Column="2"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Straight Length (ft)" />
                                                    <TextBox
                                                        Name="InLength"
                                                        TextChanged="InLength_TextChanged"
                                                        ToolTip="Length of straight duct run used for frictional drop" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="0"
                                                    Grid.Column="3"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                        <TextBlock Text="Fitting loss sum (K)" />
                                                        <TextBlock
                                                            Margin="6,0,0,0"
                                                            FontSize="12"
                                                            Foreground="{StaticResource Brush.TextSubtle}"
                                                            Text="ℹ"
                                                            ToolTip="Sum of loss coefficients from fittings; higher totals increase pressure drop." />
                                                    </StackPanel>
                                                    <TextBox Name="InLossCoeff" ToolTip="Sum of fitting loss coefficients (dimensionless); higher values add more static loss." />
                                                </StackPanel>

                                                <StackPanel
                                                    Grid.Row="1"
                                                    Grid.Column="0"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Supply Static (in. w.g.)" />
                                                    <TextBox Name="InSupplyStatic" ToolTip="Design supply fan static pressure in inches of water" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="1"
                                                    Grid.Column="1"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Return/Exhaust Static (in. w.g.)" />
                                                    <TextBox Name="InReturnStatic" ToolTip="Return or exhaust static pressure in inches of water" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="1"
                                                    Grid.Column="2"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Leakage Class (cfm/100ft² @1in)" />
                                                    <TextBox Name="InLeakageClass" ToolTip="SMACNA leakage class (3, 6, 12, 24). Default 6" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="1"
                                                    Grid.Column="3"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Leak Test Pressure (in. w.g.)" />
                                                    <TextBox Name="InLeakTestPressure" ToolTip="Test pressure for leakage calc; often design static" />
                                                </StackPanel>

                                                <StackPanel
                                                    Grid.Row="2"
                                                    Grid.Column="0"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Fan Efficiency (0-1)" />
                                                    <TextBox Name="InFanEff" ToolTip="Total-to-static fan efficiency as a decimal (e.g., 0.65)" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="2"
                                                    Grid.Column="1"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Ambient Temp (°F)" />
                                                    <TextBox Name="InAmbientTemp" ToolTip="Surrounding ambient temperature for heat gain/loss" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="2"
                                                    Grid.Column="2"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Max Allowable ΔT (°F)" />
                                                    <TextBox Name="InMaxDeltaT" ToolTip="Allowed supply temperature drop across the run" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="2"
                                                    Grid.Column="3"
                                                    Margin="4"
                                                    Orientation="Vertical">
                                                    <TextBlock Text="Existing Insulation R" />
                                                    <TextBox Name="InExistingInsulR" ToolTip="Installed insulation R (hr·ft²·°F/Btu) if known" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Expander>
                                </Border>

                                <Border
                                    Margin="0,0,0,8"
                                    Padding="8"
                                    Style="{StaticResource HighlightBorderStyle}">
                                    <StackPanel Orientation="Vertical">
                                        <TextBlock FontWeight="Bold" Text="Regional presets" />
                                        <StackPanel
                                            Margin="0,2,0,6"
                                            VerticalAlignment="Center"
                                            Orientation="Horizontal">
                                            <TextBlock
                                                Margin="0,0,8,0"
                                                VerticalAlignment="Center"
                                                Text="Code Region" />
                                            <ComboBox Name="DuctRegionCombo" Width="260" />
                                        </StackPanel>
                                        <WrapPanel Margin="0,2,0,0" HorizontalAlignment="Left">
                                            <Button
                                                Margin="0,0,10,8"
                                                Click="ApplyVelocityPreset_Click"
                                                Content="Supply main preset"
                                                Style="{StaticResource PillButtonStyle}"
                                                Tag="Supply" />
                                            <Button
                                                Margin="0,0,10,8"
                                                Click="ApplyVelocityPreset_Click"
                                                Content="Branch preset"
                                                Style="{StaticResource PillButtonStyle}"
                                                Tag="Branch" />
                                            <Button
                                                Margin="0,0,10,8"
                                                Click="ApplyVelocityPreset_Click"
                                                Content="Return/exhaust preset"
                                                Style="{StaticResource PillButtonStyle}"
                                                Tag="Return" />
                                        </WrapPanel>
                                        <TextBlock
                                            FontSize="12"
                                            Text="Presets drop region-specific ASHRAE/SMACNA velocity caps and default friction into the inputs."
                                            TextWrapping="Wrap" />
                                    </StackPanel>
                                </Border>

                                <Border
                                    Margin="0,0,0,8"
                                    Padding="6"
                                    Style="{StaticResource HighlightBorderStyle}">
                                    <StackPanel>
                                        <TextBlock FontWeight="Bold" Text="Fittings (ASHRAE/SMACNA)" />
                                        <UniformGrid Margin="0,4" Columns="3">
                                            <StackPanel Margin="4">
                                                <TextBlock Text="Fitting" />
                                                <ComboBox Name="DuctFittingCombo" DisplayMemberPath="Name" />
                                            </StackPanel>
                                            <StackPanel Margin="4">
                                                <TextBlock Text="Quantity" />
                                                <TextBox Name="DuctFittingQty" Text="1" />
                                            </StackPanel>
                                            <StackPanel
                                                Margin="4"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Bottom"
                                                Orientation="Horizontal">
                                                <Button
                                                    Width="60"
                                                    Margin="0,0,6,0"
                                                    Click="AddDuctFitting_Click"
                                                    Content="Add" />
                                                <Button
                                                    Width="70"
                                                    Margin="0,0,6,0"
                                                    Click="RemoveDuctFitting_Click"
                                                    Content="Remove" />
                                                <Button
                                                    Width="60"
                                                    Click="ClearDuctFittings_Click"
                                                    Content="Clear" />
                                            </StackPanel>
                                        </UniformGrid>
                                        <TextBlock
                                            Margin="4,0,4,6"
                                            FontSize="12"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Select a fitting, enter quantity, then Add; totals refresh below" />
                                        <Grid Margin="4,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <ListBox
                                                Name="DuctFittingRunList"
                                                Grid.Column="0"
                                                Height="120" />
                                            <Border
                                                Grid.Column="1"
                                                Margin="8,0,0,0"
                                                Padding="10,6"
                                                Background="{StaticResource Brush.EmphasisBackground}"
                                                BorderBrush="{StaticResource Brush.BorderAlt}"
                                                BorderThickness="1"
                                                CornerRadius="8">
                                                <TextBlock
                                                    Name="DuctFittingBadgeText"
                                                    VerticalAlignment="Center"
                                                    TextWrapping="Wrap" />
                                            </Border>
                                        </Grid>
                                        <UniformGrid Margin="0,4" Columns="3">
                                            <StackPanel Margin="4">
                                                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                    <TextBlock Text="Fitting loss sum (K)" />
                                                    <TextBlock
                                                        Margin="6,0,0,0"
                                                        FontSize="12"
                                                        Foreground="{StaticResource Brush.TextSubtle}"
                                                        Text="ℹ"
                                                        ToolTip="Total K for the run; higher sums raise pressure drop." />
                                                </StackPanel>
                                                <TextBox
                                                    Name="DuctFittingSumKOutput"
                                                    IsReadOnly="True"
                                                    ToolTip="Total K value from fittings; higher totals increase pressure drop." />
                                            </StackPanel>
                                            <StackPanel Margin="4">
                                                <TextBlock Text="Equivalent length (ft)" />
                                                <TextBox Name="DuctFittingEquivalentLengthOutput" IsReadOnly="True" />
                                            </StackPanel>
                                            <StackPanel Margin="4">
                                                <TextBlock Text="Total run length (ft)" />
                                                <TextBox Name="DuctTotalRunLengthOutput" IsReadOnly="True" />
                                            </StackPanel>
                                        </UniformGrid>
                                        <TextBlock
                                            Name="DuctFittingSummaryText"
                                            Margin="4,2,4,0"
                                            TextWrapping="Wrap" />
                                    </StackPanel>
                                </Border>

                                <Border
                                    Margin="0,0,0,6"
                                    Padding="6"
                                    Style="{StaticResource HighlightBorderStyle}">
                                    <StackPanel>
                                        <TextBlock FontWeight="Bold" Text="Input tips" />
                                        <TextBlock
                                            x:Name="InputTipsLine1"
                                            FontSize="12"
                                            Text="Enter CFM (ft³/min), velocity (ft/min), friction (in. w.g. per 100 ft), dimensions in inches, and lengths in feet. You can size with diameter, rectangle, or flow+velocity combinations."
                                            TextWrapping="Wrap" />
                                        <TextBlock
                                            x:Name="InputTipsLine2"
                                            FontSize="12"
                                            Text="Air temp (°F) and altitude (ft) tune density/viscosity for non-standard air. Reynolds number highlights laminar vs. turbulent flow, and the Darcy friction factor (f) feeds total pressure. Straight length and fitting loss sum add fittings to total pressure."
                                            TextWrapping="Wrap" />
                                    </StackPanel>
                                </Border>

                                <TextBlock
                                    Name="DuctCodeNote"
                                    Margin="4,0"
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    Name="DuctStatusNote"
                                    Margin="4,0,4,8"
                                    Foreground="{StaticResource Brush.TextDanger}"
                                    TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                    </ScrollViewer>

                    <ScrollViewer
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="4,6,0,0"
                        Padding="2"
                        HorizontalContentAlignment="Stretch"
                        HorizontalScrollBarVisibility="Disabled"
                        PanningMode="VerticalOnly"
                        VerticalScrollBarVisibility="Auto">
                        <Border
                            Padding="8"
                            Background="{StaticResource Brush.SurfaceAlt}"
                            BorderBrush="{StaticResource Brush.Border}"
                            BorderThickness="1"
                            CornerRadius="8">
                            <StackPanel Orientation="Vertical">
                                <StackPanel.Resources>
                                    <Style BasedOn="{StaticResource CompactOutputTextBox}" TargetType="TextBox" />
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextWrapping" Value="Wrap" />
                                    </Style>
                                </StackPanel.Resources>
                                <TextBlock
                                    Margin="0,0,0,6"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Text="Results" />

                                <UniformGrid
                                    Margin="0,0,0,4"
                                    HorizontalAlignment="Stretch"
                                    Columns="2">
                                    <Border
                                        MinWidth="160"
                                        Margin="3,0"
                                        Padding="5"
                                        Style="{StaticResource AccentCardStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Velocity (FPM)" />
                                            <TextBox
                                                Name="OutVel"
                                                Margin="0,4,0,2"
                                                IsReadOnly="True" />
                                            <WrapPanel>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock FontSize="11" Text="Code caps via region" />
                                                </Border>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock FontSize="11" Text="Supply 800–1800" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                    </Border>
                                    <Border
                                        MinWidth="160"
                                        Margin="3,0"
                                        Padding="5"
                                        Style="{StaticResource SuccessCardStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Friction (in. w.g./100 ft)" />
                                            <TextBox
                                                Name="OutDp100"
                                                Margin="0,4,0,2"
                                                IsReadOnly="True" />
                                            <WrapPanel>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock FontSize="11" Text="Equal-friction 0.05–0.10" />
                                                </Border>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock FontSize="11" Text="Quiet ≤0.08" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                    </Border>
                                    <Border
                                        MinWidth="160"
                                        Margin="3,0"
                                        Padding="5"
                                        Style="{StaticResource WarningCardStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Total ΔP (in. w.g.)" />
                                            <TextBox
                                                Name="OutTotalDp"
                                                Margin="0,4,0,2"
                                                IsReadOnly="True" />
                                            <WrapPanel>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock FontSize="11" Text="Includes fittings" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                    </Border>
                                </UniformGrid>

                                <UniformGrid
                                    Margin="0"
                                    HorizontalAlignment="Stretch"
                                    Columns="2">
                                    <Border
                                        MinWidth="240"
                                        Margin="3,3,3,0"
                                        Padding="6"
                                        Style="{StaticResource CardStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Air Data" />
                                            <UniformGrid Margin="0,4,0,0" Columns="2">
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Flow Rate (CFM)" />
                                                    <TextBox Name="OutCfm" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Reynolds (Re)" />
                                                    <TextBox Name="OutRe" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Friction Factor (f)" />
                                                    <TextBox Name="OutF" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Velocity Pressure (in. w.g.)" />
                                                    <TextBox Name="OutVp" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Density (lbm/ft³)" />
                                                    <TextBox Name="OutAirDensity" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Kinematic Viscosity (ft²/s)" />
                                                    <TextBox Name="OutAirNu" IsReadOnly="True" />
                                                </StackPanel>
                                            </UniformGrid>
                                        </StackPanel>
                                    </Border>

                                    <Border
                                        MinWidth="240"
                                        Margin="3,3,3,0"
                                        Padding="6"
                                        Style="{StaticResource WarningCardStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Pressure / Leakage / Fan" />
                                            <Grid Margin="0,4,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition />
                                                    <RowDefinition />
                                                </Grid.RowDefinitions>
                                                <StackPanel
                                                    Grid.Row="0"
                                                    Grid.Column="0"
                                                    Margin="2">
                                                    <TextBlock Text="Pressure Class (in. w.g.)" />
                                                    <TextBox Name="OutPressureClass" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="0"
                                                    Grid.Column="1"
                                                    Margin="2">
                                                    <TextBlock Text="Velocity Pressure (in. w.g.)" />
                                                    <TextBox
                                                        Name="OutVpEcho"
                                                        IsReadOnly="True"
                                                        ToolTip="Echo of velocity pressure for quick fan and pressure class checks." />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="1"
                                                    Grid.Column="0"
                                                    Margin="2">
                                                    <TextBlock Text="Fan BHP (hp)" />
                                                    <TextBox Name="OutFanBhp" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Row="1"
                                                    Grid.Column="1"
                                                    Margin="2">
                                                    <TextBlock Text="Leakage (cfm)" />
                                                    <TextBox Name="OutLeakage" IsReadOnly="True" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <Border
                                        MinWidth="240"
                                        Margin="3,3,3,0"
                                        Padding="6"
                                        Style="{StaticResource SuccessCardStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Heat / Insulation" />
                                            <UniformGrid Margin="0,4,0,0" Columns="2">
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Heat Transfer (Btuh)" />
                                                    <TextBox Name="OutHeatTransfer" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Supply ΔT (°F)" />
                                                    <TextBox Name="OutDeltaT" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Needed Insul R" />
                                                    <TextBox Name="OutRequiredR" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Est. Thickness (in)" />
                                                    <TextBox Name="OutInsulThk" IsReadOnly="True" />
                                                </StackPanel>
                                            </UniformGrid>
                                        </StackPanel>
                                    </Border>

                                    <Border
                                        MinWidth="240"
                                        Margin="3,3,3,0"
                                        Padding="6"
                                        Style="{StaticResource CardStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Geometry" />
                                            <UniformGrid Margin="0,4,0,0" Columns="3">
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Round Dia (in)" />
                                                    <TextBox Name="OutDia" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Rect Side 1 (in)" />
                                                    <TextBox Name="OutRS1" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Rect Side 2 (in)" />
                                                    <TextBox Name="OutRS2" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Oval Major (in)" />
                                                    <TextBox Name="OutOS1" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="2">
                                                    <TextBlock Text="Oval Minor (in)" />
                                                    <TextBox Name="OutOS2" IsReadOnly="True" />
                                                </StackPanel>
                                            </UniformGrid>
                                            <StackPanel Margin="0,6,0,0">
                                                <Expander Margin="0,2,0,0" Header="Round details">
                                                    <UniformGrid Margin="0,4,0,0" Columns="2">
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Area (ft²)" />
                                                            <TextBox Name="OutAreaRound" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Circumference (ft)" />
                                                            <TextBox Name="OutCircRound" IsReadOnly="True" />
                                                        </StackPanel>
                                                    </UniformGrid>
                                                </Expander>
                                                <Expander Margin="0,2,0,0" Header="Rectangular details">
                                                    <UniformGrid Margin="0,4,0,0" Columns="3">
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Aspect Ratio" />
                                                            <TextBox Name="OutRAR" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Area (ft²)" />
                                                            <TextBox Name="OutRArea" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Perimeter (ft)" />
                                                            <TextBox Name="OutRPerim" IsReadOnly="True" />
                                                        </StackPanel>
                                                    </UniformGrid>
                                                </Expander>
                                                <Expander Margin="0,2,0,0" Header="Flat oval details">
                                                    <UniformGrid Margin="0,4,0,0" Columns="3">
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Aspect Ratio" />
                                                            <TextBox Name="OutOAR" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Area (ft²)" />
                                                            <TextBox Name="OutOArea" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="2">
                                                            <TextBlock Text="Perimeter (ft)" />
                                                            <TextBox Name="OutOPerim" IsReadOnly="True" />
                                                        </StackPanel>
                                                    </UniformGrid>
                                                </Expander>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </UniformGrid>
                            </StackPanel>
                        </Border>
                    </ScrollViewer>
                </Grid>
            </TabItem>

            <TabItem Header="Mixed Air">
                <ScrollViewer
                    Margin="4"
                    Padding="4"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
                    <StackPanel Orientation="Vertical">
                        <Border Margin="0,0,0,10" Padding="8" Style="{StaticResource HighlightBorderStyle}">
                            <StackPanel>
                                <TextBlock FontWeight="Bold" Text="Quick steps" />
                                <TextBlock
                                    Margin="0,4,0,0"
                                    FontSize="12"
                                    Text="1) Enter any two airflow values (total/OA/RA/OA%) and outdoor + return DB/WB."
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    Margin="0,2,0,0"
                                    FontSize="12"
                                    Text="2) Click Calculate to solve the remaining flows and mixed-air properties."
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    Margin="0,2,0,0"
                                    FontSize="12"
                                    Text="3) Altitude is optional; leave blank for sea level density."
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    x:Name="MixedAirStatus"
                                    Margin="0,6,0,0"
                                    FontSize="12"
                                    Foreground="{StaticResource Brush.TextSubtle}"
                                    TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*" />
                                <ColumnDefinition Width="2*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Orientation="Vertical">
                                <Border Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock FontSize="14" FontWeight="Bold" Text="Airflow inputs (any two)" />
                                        <TextBlock
                                            Margin="0,2,0,6"
                                            FontSize="12"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Enter any two of the four airflow fields; the rest will auto-solve." />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>
                                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="2">
                                                <TextBlock Text="Total supply (cfm)" />
                                                <TextBox Name="MixedTotalCfmInput" Style="{StaticResource CompactInputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="2">
                                                <TextBlock Text="Outside air (%)" />
                                                <TextBox Name="MixedOaPercentInput" Style="{StaticResource CompactInputTextBox}" />
                                                <TextBlock Style="{StaticResource UnitLabelStyle}" Text="0–100%" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="2">
                                                <TextBlock Text="Outside air (cfm)" />
                                                <TextBox Name="MixedOaCfmInput" Style="{StaticResource CompactInputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="2">
                                                <TextBlock Text="Return air (cfm)" />
                                                <TextBox Name="MixedRaCfmInput" Style="{StaticResource CompactInputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="2">
                                                <TextBlock Text="Outdoor dry-bulb (°F)" />
                                                <TextBox Name="MixedOutdoorDbInput" Style="{StaticResource CompactInputTextBox}" />
                                                <TextBlock Style="{StaticResource UnitLabelStyle}" Text="Use paired DB/WB values" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="2">
                                                <TextBlock Text="Outdoor wet-bulb (°F)" />
                                                <TextBox Name="MixedOutdoorWbInput" Style="{StaticResource CompactInputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="3" Grid.Column="0" Margin="2">
                                                <TextBlock Text="Return dry-bulb (°F)" />
                                                <TextBox Name="MixedReturnDbInput" Style="{StaticResource CompactInputTextBox}" />
                                                <TextBlock Style="{StaticResource UnitLabelStyle}" Text="DB must be ≥ WB" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="2">
                                                <TextBlock Text="Return wet-bulb (°F)" />
                                                <TextBox Name="MixedReturnWbInput" Style="{StaticResource CompactInputTextBox}" />
                                            </StackPanel>
                                        </Grid>
                                        <StackPanel Margin="0,10,0,0" Orientation="Horizontal">
                                            <StackPanel Margin="2" Width="200">
                                                <TextBlock Text="Altitude (ft, optional)" />
                                                <TextBox Name="MixedAltitudeInput" Style="{StaticResource CompactInputTextBox}" />
                                                <TextBlock Style="{StaticResource UnitLabelStyle}" Text="Blank = sea level" />
                                            </StackPanel>
                                            <Button
                                                Name="MixedAirCalcButton"
                                                Width="200"
                                                Margin="8,18,0,0"
                                                Click="MixedAirCalcButton_Click"
                                                Content="Calculate mixed air"
                                                Style="{StaticResource PrimaryButtonStyle}" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Vertical">
                                <Border Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock FontSize="14" FontWeight="Bold" Text="Solved airflows" />
                                        <UniformGrid Margin="0,6,0,0" Columns="2">
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Total supply (cfm)" />
                                                <TextBox Name="MixedTotalCfmOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Outside air (%)" />
                                                <TextBox Name="MixedOaPercentOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Outside air (cfm)" />
                                                <TextBox Name="MixedOaCfmOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Return air (cfm)" />
                                                <TextBox Name="MixedRaCfmOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                        </UniformGrid>
                                    </StackPanel>
                                </Border>

                                <Border Style="{StaticResource HighlightBorderStyle}">
                                    <StackPanel>
                                        <TextBlock FontSize="14" FontWeight="Bold" Text="Mixed air properties" />
                                        <UniformGrid Margin="0,6,0,0" Columns="2">
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Dry-bulb (°F)" />
                                                <TextBox Name="MixedAirDbOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Wet-bulb (°F)" />
                                                <TextBox Name="MixedAirWbOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Dew point (°F)" />
                                                <TextBox Name="MixedAirDpOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Humidity ratio (gr/lb)" />
                                                <TextBox Name="MixedAirHrOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Enthalpy (Btu/lb)" />
                                                <TextBox Name="MixedAirEnthalpyOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Density (lb/ft³)" />
                                                <TextBox Name="MixedAirDensityOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Specific volume (ft³/lb)" />
                                                <TextBox Name="MixedAirSpVolOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                            <StackPanel Margin="2">
                                                <TextBlock Text="Mass flow (lb/hr)" />
                                                <TextBox Name="MixedAirMassFlowOutput" Style="{StaticResource CompactOutputTextBox}" />
                                            </StackPanel>
                                        </UniformGrid>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Plumbing">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock
                                FontSize="14"
                                FontWeight="Bold"
                                Text="Plumbing Guide" />
                            <TextBlock
                                Margin="0,4,0,8"
                                FontSize="12"
                                Foreground="{StaticResource Brush.TextSubtle}"
                                Text="Jump between cards and follow the quick steps in each section."
                                TextWrapping="Wrap" />
                            <StackPanel>
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="Loss"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference LossCard}" />
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="Target Friction"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference TargetFrictionCard}" />
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="Fixture Units"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference FixtureUnitsCard}" />
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="Sanitary"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference SanitaryCard}" />
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="Stormwater"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference StormwaterCard}" />
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="Natural Gas"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference GasCard}" />
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="DHW Recirc"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference RecircCard}" />
                                <Button
                                    Margin="0,4,0,0"
                                    Click="NavigateToCard_Click"
                                    Content="Water Hammer"
                                    Style="{StaticResource PillButtonStyle}"
                                    Tag="{x:Reference HammerCard}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <ScrollViewer
                        Grid.Column="1"
                        HorizontalContentAlignment="Stretch"
                        HorizontalScrollBarVisibility="Disabled"
                        PanningMode="VerticalOnly"
                        VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="8" Orientation="Vertical">
                            <Border Style="{StaticResource AccentCardStyle}">
                                <StackPanel>
                                    <TextBlock FontWeight="Bold" Text="Plumbing overview" />
                                    <TextBlock
                                        Margin="0,2,0,4"
                                        FontSize="12"
                                        Text="Use the cards below to size supply, drainage, and specialty piping. Each card lists the quick steps to stay on track."
                                        TextWrapping="Wrap" />
                                    <WrapPanel>
                                        <Border Style="{StaticResource ChipBorderStyle}">
                                            <TextBlock FontSize="11" Text="UPC: ≤10 ft/s cold, ≤8 ft/s hot" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}">
                                            <TextBlock FontSize="11" Text="ASPE: target 2–8 ft/s" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}">
                                            <TextBlock FontSize="11" Text="Fixture-unit guardrails per IPC/UPC tables" />
                                        </Border>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>

                            <Border x:Name="LossCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Loss" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter flow, length, and nominal size or explicit ID with material and fluid details. Step 2: Pick a region and add fittings. Step 3: Calculate loss, clear, or export."
                                        TextWrapping="Wrap" />
                                    <TextBlock FontWeight="Bold" Text="Pipe Conditions" />
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Flow (gpm)" />
                                            <TextBox Name="PlGpmInput" ToolTip="Gallons per minute" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Length (ft)" />
                                            <TextBox
                                                Name="PlLengthInput"
                                                TextChanged="PlLengthInput_TextChanged"
                                                ToolTip="Straight length for friction in feet" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Nominal Size (in)" />
                                            <TextBox Name="PlNominalInput" ToolTip="Nominal trade size in inches" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Explicit ID (in)" />
                                            <TextBox Name="PlExplicitIdInput" ToolTip="Override with an inside diameter in inches" />
                                        </StackPanel>
                                    </UniformGrid>

                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Material" />
                                            <ComboBox Name="PlMaterialCombo" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <CheckBox Name="PlUseAgedC" Content="Use aged C-factor" />
                                            <CheckBox Name="PlIsHotWater" Content="Hot water (velocity check)" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Fluid" />
                                            <ComboBox Name="PlAntifreezeTypeCombo" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Fluid Temp (°F)" />
                                            <TextBox Name="PlFluidTempInput" ToolTip="Temperature of the fluid stream in °F" />
                                        </StackPanel>
                                    </UniformGrid>

                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Antifreeze %" />
                                            <TextBox Name="PlAntifreezePercentInput" ToolTip="Percentage of glycol by volume (0–60%)" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Available head / pump duty (psi)" />
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox
                                                    Name="PlAvailableHeadPsiInput"
                                                    Width="130"
                                                    ToolTip="Available head or boost pressure in psi" />
                                                <TextBlock
                                                    Margin="6,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Text="psi" />
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Available head / pump duty (ft head)" />
                                            <StackPanel Orientation="Horizontal">
                                                <TextBox
                                                    Name="PlAvailableHeadFtInput"
                                                    Width="130"
                                                    ToolTip="Available head or pump duty in feet of head" />
                                                <TextBlock
                                                    Margin="6,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Text="ft head" />
                                            </StackPanel>
                                        </StackPanel>
                                    </UniformGrid>

                                    <StackPanel
                                        Margin="4,4,4,0"
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal">
                                        <TextBlock
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center"
                                            Text="Code Region" />
                                        <ComboBox Name="PlRegionCombo" Width="260" />
                                    </StackPanel>

                                    <Border
                                        Margin="4,8,4,4"
                                        Padding="8"
                                        Background="{StaticResource Brush.EmphasisBackground}"
                                        BorderBrush="{StaticResource Brush.BorderAlt}"
                                        BorderThickness="1"
                                        CornerRadius="8">
                                        <StackPanel Orientation="Vertical">
                                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                <Button
                                                    Width="150"
                                                    Margin="0,0,8,0"
                                                    Click="BtnPlCalc_Click"
                                                    Content="Calculate Loss"
                                                    Style="{StaticResource PrimaryButtonStyle}" />
                                                <Button
                                                    Width="90"
                                                    Margin="0,0,8,0"
                                                    Click="BtnPlClear_Click"
                                                    Content="Clear" />
                                                <Button
                                                    Width="150"
                                                    Click="BtnExportPlumbing_Click"
                                                    Content="Export to CSV" />
                                            </StackPanel>
                                            <TextBlock
                                                Margin="2,6,0,0"
                                                FontSize="11"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Run, reset, or export results without scrolling; you can still use the fitting tools below." />
                                        </StackPanel>
                                    </Border>

                                    <Border
                                        Margin="4"
                                        Padding="8"
                                        CornerRadius="8"
                                        Style="{StaticResource HighlightBorderStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Fittings (ASPE/UPC)" />
                                            <TextBlock
                                                Margin="0,2,0,6"
                                                FontSize="12"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Step 2 helper: select a fitting, add quantities, and review equivalent lengths."
                                                TextWrapping="Wrap" />
                                            <UniformGrid Margin="0,4" Columns="3">
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Fitting" />
                                                    <ComboBox Name="PlFittingCombo" DisplayMemberPath="Name" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Qty" />
                                                    <TextBox Name="PlFittingQty" />
                                                </StackPanel>
                                                <StackPanel
                                                    Margin="4"
                                                    VerticalAlignment="Bottom"
                                                    Orientation="Horizontal">
                                                    <Button
                                                        Width="60"
                                                        Margin="0,0,6,0"
                                                        Click="AddPlumbingFitting_Click"
                                                        Content="Add" />
                                                    <Button
                                                        Width="70"
                                                        Margin="0,0,6,0"
                                                        Click="RemovePlumbingFitting_Click"
                                                        Content="Remove" />
                                                    <Button
                                                        Width="60"
                                                        Click="ClearPlumbingFittings_Click"
                                                        Content="Clear" />
                                                </StackPanel>
                                            </UniformGrid>
                                            <TextBlock
                                                Margin="4,0,4,2"
                                                FontSize="12"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Fittings use ASPE K factors and UPC equivalent length guidance." />
                                            <TextBlock
                                                Margin="4,0,4,6"
                                                FontSize="11"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Needs fitting + qty; outputs fitting loss sum (K) and equivalent length." />
                                            <Grid Margin="4,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <ListBox
                                                    Name="PlFittingRunList"
                                                    Grid.Column="0"
                                                    Height="120" />
                                                <Border
                                                    Grid.Column="1"
                                                    Margin="8,0,0,0"
                                                    Padding="10,6"
                                                    Background="{StaticResource Brush.EmphasisBackground}"
                                                    BorderBrush="{StaticResource Brush.BorderAlt}"
                                                    BorderThickness="1"
                                                    CornerRadius="8">
                                                    <TextBlock
                                                        Name="PlFittingBadgeText"
                                                        VerticalAlignment="Center"
                                                        TextWrapping="Wrap" />
                                                </Border>
                                            </Grid>
                                            <UniformGrid Margin="0,4" Columns="3">
                                                <StackPanel Margin="4">
                                                    <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                        <TextBlock Text="Fitting loss sum (K)" />
                                                        <TextBlock
                                                            Margin="6,0,0,0"
                                                            FontSize="12"
                                                            Foreground="{StaticResource Brush.TextSubtle}"
                                                            Text="ℹ"
                                                            ToolTip="Total K for the plumbing run; higher sums raise pressure drop." />
                                                    </StackPanel>
                                                    <TextBox
                                                        Name="PlFittingSumKOutput"
                                                        IsReadOnly="True"
                                                        ToolTip="Sum of plumbing fitting K values; higher totals increase pressure drop." />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Equivalent length (ft)" />
                                                    <TextBox Name="PlFittingEquivalentLengthOutput" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Total run length (ft)" />
                                                    <TextBox Name="PlTotalRunLengthOutput" IsReadOnly="True" />
                                                </StackPanel>
                                            </UniformGrid>
                                            <TextBlock
                                                Name="PlFittingSummaryText"
                                                Margin="4,2,4,0"
                                                TextWrapping="Wrap" />
                                        </StackPanel>
                                    </Border>

                                    <Border
                                        Margin="4,0,4,8"
                                        Padding="8"
                                        CornerRadius="8"
                                        Style="{StaticResource WarningBorderStyle}">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="Input tips" />
                                            <TextBlock
                                                FontSize="12"
                                                Text="Enter flow in gpm, lengths in feet, nominal sizes in inches, and IDs in inches. Hazen-Williams pressure drop per 100 ft follows IPC/UPC practice; Darcy-Weisbach uses roughness from material and Re from flow."
                                                TextWrapping="Wrap" />
                                            <TextBlock
                                                FontSize="12"
                                                Text="Use the hot-water checkbox for velocity caps (cold water under 8 ft/s is a common goal), and switch to aged C-factors for conservative rehab sizing."
                                                TextWrapping="Wrap" />
                                            <TextBlock
                                                FontSize="12"
                                                Text="Fluid temperature and glycol percentage tune density/viscosity, adjust Hazen-Williams C, and slightly increase roughness for heavy mixes. Reynolds number flags laminar (&lt;2,000), transitional (≈2,000–4,000), or turbulent (&gt;4,000) flow; Darcy f typically lands 0.015–0.03 in clean, turbulent piping; higher viscosity lowers Re and raises f."
                                                TextWrapping="Wrap" />
                                        </StackPanel>
                                    </Border>

                                    <TextBlock FontWeight="Bold" Text="Results" />
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontSize="12"
                                        Text="After Calculate Loss, review the resolved ID, velocity, and pressure drop from your flow, length, size, material, and fittings."
                                        TextWrapping="Wrap" />
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Resolved ID (in)" />
                                            <TextBox Name="PlResolvedIdOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Velocity (ft/s)" />
                                            <TextBox
                                                Name="PlVelocityOutput"
                                                IsReadOnly="True"
                                                ToolTip="Aim under ~8 ft/s for cold domestic water; under ~5 ft/s for hot water or glycol to limit noise and erosion." />
                                            <WrapPanel>
                                                <Border
                                                    Background="{StaticResource Brush.ChipSuccessBackground}"
                                                    BorderBrush="{StaticResource Brush.ChipSuccessBorder}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextSuccess}"
                                                        Text="Cold water target: &lt; 8 ft/s" />
                                                </Border>
                                                <Border
                                                    Background="{StaticResource Brush.ChipWarningBackground}"
                                                    BorderBrush="{StaticResource Brush.ChipWarningBorder}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextWarning}"
                                                        Text="Hot/glycol: &lt; 5 ft/s" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Reynolds Number" />
                                            <TextBox
                                                Name="PlReOutput"
                                                IsReadOnly="True"
                                                ToolTip="&lt;2,000 is laminar, 2,000–4,000 transitional, and &gt;4,000 turbulent; turbulent flow keeps Hazen-Williams and Moody charts valid." />
                                            <WrapPanel>
                                                <Border
                                                    Background="{StaticResource Brush.ChipInfoBackground}"
                                                    BorderBrush="{StaticResource Brush.ChipInfoBorder}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextInfo}"
                                                        Text="Turbulent sweet spot: &gt; 4,000" />
                                                </Border>
                                                <Border
                                                    Background="{StaticResource Brush.ChipWarningBackground}"
                                                    BorderBrush="{StaticResource Brush.ChipWarningBorder}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextWarning}"
                                                        Text="Transitional: 2,000–4,000" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Darcy f" />
                                            <TextBox
                                                Name="PlFrictionOutput"
                                                IsReadOnly="True"
                                                ToolTip="Clean turbulent piping often yields f between 0.015–0.03; higher values signal rough pipe, low Re, or scale." />
                                            <WrapPanel>
                                                <Border
                                                    Background="{StaticResource Brush.CardAltBackground}"
                                                    BorderBrush="{StaticResource Brush.BorderAlt}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextInfo}"
                                                        Text="Typical clean: 0.015–0.03" />
                                                </Border>
                                                <Border
                                                    Background="{StaticResource Brush.ChipDangerBackground}"
                                                    BorderBrush="{StaticResource Brush.ChipDangerBorder}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextDangerSoft}"
                                                        Text="High? check scale/viscosity" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Fluid Density (lb/ft³)" />
                                            <TextBox Name="PlFluidDensityOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Kinematic viscosity (ft²/s)" />
                                            <TextBox
                                                Name="PlFluidNuOutput"
                                                IsReadOnly="True"
                                                ToolTip="Higher viscosity lowers Reynolds number and can raise Darcy f; cooler water or glycol mixes increase viscosity." />
                                            <WrapPanel>
                                                <Border
                                                    Background="{StaticResource Brush.ChipPurpleBackground}"
                                                    BorderBrush="{StaticResource Brush.ChipPurpleBorder}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextMutedStrong}"
                                                        Text="Lower ν → higher Re" />
                                                </Border>
                                                <Border
                                                    Background="{StaticResource Brush.ChipWarningBackground}"
                                                    BorderBrush="{StaticResource Brush.ChipWarningBorder}"
                                                    Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="{StaticResource Brush.TextWarning}"
                                                        Text="High ν? expect higher f" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                    </UniformGrid>

                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Hazen-Williams drop (psi/100 ft)" />
                                            <TextBox Name="PlHazenPsi100Output" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Hazen-Williams total drop (psi)" />
                                            <TextBox Name="PlHazenPsiTotalOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Darcy-Weisbach drop (psi/100 ft)" />
                                            <TextBox Name="PlDarcyPsi100Output" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Darcy-Weisbach total drop (psi)" />
                                            <TextBox Name="PlDarcyPsiTotalOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>

                                    <TextBlock
                                        Name="PlVelocityNote"
                                        Margin="4,0"
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        Name="PlStatusNote"
                                        Margin="4,0,4,0"
                                        Foreground="{StaticResource Brush.TextDanger}"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border x:Name="TargetFrictionCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Target Friction" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter flow and target pressure drop per 100 ft. Step 2: Solve the inside diameter. Step 3: Review the nearest nominal size."
                                        TextWrapping="Wrap" />
                                    <TextBlock FontWeight="Bold" Text="Size for Target Friction" />
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontSize="12"
                                        Text="Enter flow and a target pressure drop per 100 ft, then Solve Diameter to get an inside diameter and the nearest nominal size."
                                        TextWrapping="Wrap" />
                                    <UniformGrid Margin="0,4" Columns="3">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Flow (gpm)" />
                                            <TextBox Name="PlSizeGpmInput" ToolTip="Gallons per minute" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Target drop (psi/100 ft)" />
                                            <TextBox Name="PlTargetPsi100Input" ToolTip="Pressure drop target in psi per 100 ft" />
                                        </StackPanel>
                                    </UniformGrid>

                                    <StackPanel
                                        Margin="0,4,0,8"
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal">
                                        <Button
                                            Width="140"
                                            Click="BtnPlSize_Click"
                                            Content="Solve Diameter" />
                                        <TextBlock
                                            Margin="8,0,0,0"
                                            VerticalAlignment="Center"
                                            FontSize="11"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Needs flow + target drop per 100 ft; outputs ID and nearest nominal size." />
                                    </StackPanel>

                                    <UniformGrid Margin="0,4" Columns="3">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Solved ID (in)" />
                                            <TextBox Name="PlSizedDiameterOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Nearest Nominal (in)" />
                                            <TextBox Name="PlSizedNominalOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>

                                    <TextBlock
                                        Name="PlSizeNote"
                                        Margin="4,0"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border x:Name="FixtureUnitsCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Fixture Units" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Build a fixture list. Step 2: Review the auto-summed fixture units and probable demand. Step 3: Use the demand to size branches and mains."
                                        TextWrapping="Wrap" />
                                    <TextBlock FontWeight="Bold" Text="Fixture Units &amp; Drainage" />
                                    <TextBlock
                                        Margin="0,0,0,8"
                                        FontSize="12"
                                        Text="Select fixture types, quantities, and optional overrides. Defaults come from IPC/UPC fixture-unit tables. The schedule auto-sums total FU and probable demand."
                                        TextWrapping="Wrap" />

                                    <StackPanel Margin="0,0,0,8">
                                        <TextBlock FontWeight="Bold" Text="Custom fixture types" />
                                        <TextBlock
                                            Margin="0,0,0,4"
                                            FontSize="12"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Add your own fixtures with default FU values, then edit or delete them as needed."
                                            TextWrapping="Wrap" />
                                        <UniformGrid Margin="0,0,0,6" Columns="3">
                                            <StackPanel Margin="4">
                                                <TextBlock Text="Fixture name" />
                                                <TextBox Name="CustomFixtureNameInput" />
                                            </StackPanel>
                                            <StackPanel Margin="4">
                                                <TextBlock Text="Default FU" />
                                                <TextBox Name="CustomFixtureFuInput" ToolTip="Default fixture units" />
                                            </StackPanel>
                                            <StackPanel Margin="4" VerticalAlignment="Bottom">
                                                <Button
                                                    Width="160"
                                                    Click="AddCustomFixture_Click"
                                                    Content="Add Custom Fixture" />
                                            </StackPanel>
                                        </UniformGrid>
                                        <ItemsControl ItemsSource="{Binding CustomFixtures}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="2,4">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="3*" />
                                                            <ColumnDefinition Width="1.2*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBox Grid.Column="0" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" />
                                                        <TextBox
                                                            Grid.Column="1"
                                                            Margin="6,0,0,0"
                                                            Text="{Binding FixtureUnits, UpdateSourceTrigger=PropertyChanged}" />
                                                        <Button
                                                            Grid.Column="2"
                                                            Margin="6,0,0,0"
                                                            Click="RemoveCustomFixture_Click"
                                                            Content="Delete"
                                                            Tag="{Binding}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>

                                    <StackPanel
                                        Margin="0,0,0,8"
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal">
                                        <Button
                                            Width="100"
                                            Click="AddFixtureRow_Click"
                                            Content="Add Fixture" />
                                        <TextBlock
                                            Margin="8,0,0,0"
                                            VerticalAlignment="Center"
                                            FontSize="11"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Use default fixture units or override when needed." />
                                    </StackPanel>

                                    <Border
                                        Background="{StaticResource Brush.Surface}"
                                        BorderBrush="{StaticResource Brush.BorderMuted}"
                                        BorderThickness="1"
                                        CornerRadius="8">
                                        <StackPanel>
                                            <Grid Margin="6">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="3*" />
                                                    <ColumnDefinition Width="1.5*" />
                                                    <ColumnDefinition Width="1.4*" />
                                                    <ColumnDefinition Width="1.6*" />
                                                    <ColumnDefinition Width="1.5*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock FontWeight="Bold" Text="Fixture" />
                                                <TextBlock
                                                    Grid.Column="1"
                                                    FontWeight="Bold"
                                                    Text="Default FU" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    FontWeight="Bold"
                                                    Text="Quantity" />
                                                <TextBlock
                                                    Grid.Column="3"
                                                    FontWeight="Bold"
                                                    Text="Override FU" />
                                                <TextBlock
                                                    Grid.Column="4"
                                                    FontWeight="Bold"
                                                    Text="Row Total" />
                                            </Grid>
                                            <Separator />
                                            <ItemsControl ItemsSource="{Binding FixtureRows}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="6">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="3*" />
                                                                <ColumnDefinition Width="1.5*" />
                                                                <ColumnDefinition Width="1.4*" />
                                                                <ColumnDefinition Width="1.6*" />
                                                                <ColumnDefinition Width="1.5*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <ComboBox
                                                                Grid.Column="0"
                                                                DisplayMemberPath="Name"
                                                                ItemsSource="{Binding DataContext.FixtureCatalog, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                SelectedItem="{Binding FixtureType, Mode=TwoWay}"
                                                                SelectionChanged="FixtureType_SelectionChanged" />
                                                            <TextBlock
                                                                Grid.Column="1"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding DefaultFixtureUnits, StringFormat=0.###}" />
                                                            <TextBox
                                                                Grid.Column="2"
                                                                Text="{Binding QuantityText, UpdateSourceTrigger=PropertyChanged}"
                                                                ToolTip="Number of fixtures" />
                                                            <TextBox
                                                                Grid.Column="3"
                                                                Text="{Binding OverrideText, UpdateSourceTrigger=PropertyChanged}"
                                                                ToolTip="Optional override per-fixture FU" />
                                                            <TextBlock
                                                                Grid.Column="4"
                                                                VerticalAlignment="Center"
                                                                Text="{Binding ResolvedFixtureUnits, StringFormat=0.###}" />
                                                            <Button
                                                                Grid.Column="5"
                                                                Margin="6,0,0,0"
                                                                Click="RemoveFixtureRow_Click"
                                                                Content="Remove"
                                                                Tag="{Binding}" />
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <UniformGrid Margin="0,8,0,0" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Total Fixture Units" />
                                            <TextBox Name="FixtureUnitsInput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel
                                            Margin="4"
                                            VerticalAlignment="Bottom"
                                            Orientation="Horizontal">
                                            <Button
                                                Width="160"
                                                Click="BtnFixtureDemand_Click"
                                                Content="Calc Hunter Demand" />
                                            <TextBlock
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="11"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Auto-updates when fixtures change." />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Probable Demand (gpm)" />
                                            <TextBox Name="FixtureDemandOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                </StackPanel>
                            </Border>

                            <Border x:Name="SanitaryCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Sanitary" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter DFU and slope. Step 2: Size for minimum diameter. Step 3: Check allowable DFU for existing sizes."
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontSize="12"
                                        Text="Enter DFU and slope, then Size Sanitary to get a minimum diameter or check allowable DFU at a chosen size."
                                        TextWrapping="Wrap" />

                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Sanitary DFU" />
                                            <TextBox Name="SanitaryDfuInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Slope (ft/ft)" />
                                            <TextBox Name="SanitarySlopeInput" />
                                        </StackPanel>
                                        <StackPanel
                                            Margin="4"
                                            VerticalAlignment="Bottom"
                                            Orientation="Horizontal">
                                            <Button
                                                Width="140"
                                                Click="BtnSanitarySize_Click"
                                                Content="Size Sanitary" />
                                            <TextBlock
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="11"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Needs DFU + slope; outputs minimum diameter." />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Min Diameter (in)" />
                                            <TextBox Name="SanitaryDiameterOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Check DFU @ Dia" />
                                            <TextBox Name="SanitaryCheckDiameterInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Slope (ft/ft)" />
                                            <TextBox Name="SanitaryCheckSlopeInput" />
                                        </StackPanel>
                                        <StackPanel
                                            Margin="4"
                                            VerticalAlignment="Bottom"
                                            Orientation="Horizontal">
                                            <Button
                                                Width="140"
                                                Click="BtnSanitaryAllowable_Click"
                                                Content="Allowable DFU" />
                                            <TextBlock
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="11"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Needs diameter + slope; outputs allowable DFU." />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Allowable DFU" />
                                            <TextBox Name="SanitaryAllowableOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock
                                        Name="SanitaryNote"
                                        Margin="4,0"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border x:Name="VentStackCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Vent Stack" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter vented DFU and developed length, then size the vent stack. Step 2: Check allowable DFU for an existing vent size."
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontSize="12"
                                        Text="Enter vented DFU and developed length to size a vent stack, or check allowable DFU at a given vent diameter and length."
                                        TextWrapping="Wrap" />

                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Vented DFU" />
                                            <TextBox Name="VentDfuInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Vent Length (ft)" />
                                            <TextBox Name="VentLengthInput" />
                                        </StackPanel>
                                        <StackPanel
                                            Margin="4"
                                            VerticalAlignment="Bottom"
                                            Orientation="Horizontal">
                                            <Button
                                                Width="140"
                                                Click="BtnVentSize_Click"
                                                Content="Size Vent Stack" />
                                            <TextBlock
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="11"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Needs vent DFU + length; outputs vent diameter." />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Vent Diameter (in)" />
                                            <TextBox Name="VentDiameterOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Check Vent Dia (in)" />
                                            <TextBox Name="VentDiameterCheckInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Developed Length (ft)" />
                                            <TextBox Name="VentLengthCheckInput" />
                                        </StackPanel>
                                        <StackPanel
                                            Margin="4"
                                            VerticalAlignment="Bottom"
                                            Orientation="Horizontal">
                                            <Button
                                                Width="140"
                                                Click="BtnVentAllowable_Click"
                                                Content="Allowable DFU" />
                                            <TextBlock
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="11"
                                                Foreground="{StaticResource Brush.TextSubtle}"
                                                Text="Needs vent size + length; outputs allowable DFU." />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Allowable DFU" />
                                            <TextBox Name="VentAllowableOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                </StackPanel>
                            </Border>

                            <Border x:Name="StormwaterCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Stormwater" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter roof area, rainfall, slope, and roughness. Step 2: Run storm sizing and partial-flow checks. Step 3: Check leaders."
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontSize="12"
                                        Text="Enter roof area, rainfall, slope, and Manning n, then run the storm calculations to size drains, partial-flow segments, and leaders."
                                        TextWrapping="Wrap" />
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Roof/Area (ft²)" />
                                            <TextBox Name="StormAreaInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Rainfall Intensity (in/hr)" />
                                            <TextBox Name="StormRainfallInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Slope (ft/ft)" />
                                            <TextBox Name="StormSlopeInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Manning n" />
                                            <TextBox Name="StormRoughnessInput" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <StackPanel Margin="0,4,0,8" Orientation="Horizontal">
                                        <Button
                                            Width="160"
                                            Click="BtnStormSize_Click"
                                            Content="Calc Storm Size" />
                                        <Button
                                            Width="160"
                                            Margin="8,0,0,0"
                                            Click="BtnStormPartialSize_Click"
                                            Content="Partial Flow Size" />
                                    </StackPanel>
                                    <UniformGrid Margin="0,4" Columns="3">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Storm Flow (gpm)" />
                                            <TextBox Name="StormFlowOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Required Diameter (in)" />
                                            <TextBox Name="StormDiameterOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Partial Depth Ratio (y/D)" />
                                            <TextBox Name="StormDepthRatioInput" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <UniformGrid Margin="0,4" Columns="3">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Partial-Flow Dia (in)" />
                                            <TextBox Name="StormPartialDiameterOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>

                                    <UniformGrid Margin="0,4" Columns="3">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Leader Flow (gpm)" />
                                            <TextBox Name="StormLeaderFlowInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Leader Dia (in)" />
                                            <TextBox Name="StormLeaderDiameterInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <Button
                                                Width="140"
                                                Click="BtnStormLeaderCheck_Click"
                                                Content="Check Leader" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <UniformGrid Margin="0,4" Columns="3">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Leader Capacity (gpm)" />
                                            <TextBox Name="StormLeaderCapacityOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Sized Leader Dia (in)" />
                                            <TextBox Name="StormLeaderSizedOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock
                                        Name="StormNote"
                                        Margin="4,0"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border x:Name="GasCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Natural Gas (IFGC/NFPA 54)" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter load, length, pressure drop, and properties. Step 2: Size gas. Step 3: Review diameter, flow, and velocity."
                                        TextWrapping="Wrap" />
                                    <UniformGrid Margin="0,4" Columns="5">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Load (MBH)" />
                                            <TextBox Name="GasLoadInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Length (ft)" />
                                            <TextBox Name="GasLengthInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="ΔP (in. w.c.)" />
                                            <TextBox Name="GasPressureDropInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Specific Gravity" />
                                            <TextBox Name="GasSpecificGravityInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Base Pressure (psi)" />
                                            <TextBox Name="GasBasePressureInput" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <StackPanel Margin="0,4,0,8" Orientation="Horizontal">
                                        <Button
                                            Width="140"
                                            Click="BtnGasSize_Click"
                                            Content="Size Gas" />
                                    </StackPanel>
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Required Dia (in)" />
                                            <TextBox Name="GasDiameterOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Flow (scfh)" />
                                            <TextBox Name="GasFlowOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Velocity (ft/s)" />
                                            <TextBox Name="GasVelocityOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock
                                        Name="GasNote"
                                        Margin="4,0"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border x:Name="RecircCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="DHW Recirculation" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter loop volume, turnover, and heat loss. Step 2: Add pipe and fitting lengths. Step 3: Calculate recirculation flow and head."
                                        TextWrapping="Wrap" />
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Loop Volume (gal)" />
                                            <TextBox Name="RecircVolumeInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Turnover (min)" />
                                            <TextBox Name="RecircTurnoverInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Heat Loss (Btuh)" />
                                            <TextBox Name="RecircHeatLossInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Allowed ΔT (°F)" />
                                            <TextBox Name="RecircDeltaTInput" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Recirc Dia (in)" />
                                            <TextBox Name="RecircDiaInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="C-factor" />
                                            <TextBox Name="RecircCInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Run Length (ft)" />
                                            <TextBox Name="RecircLengthInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Fitting Eq. Length (ft)" />
                                            <TextBox Name="RecircEqLengthInput" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <StackPanel Margin="0,4,0,8" Orientation="Horizontal">
                                        <Button
                                            Width="140"
                                            Click="BtnRecircCalc_Click"
                                            Content="Calc Recirc" />
                                    </StackPanel>
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Recirc Flow (gpm)" />
                                            <TextBox Name="RecircFlowOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Recirc Head (ft)" />
                                            <TextBox Name="RecircHeadOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Recirc Head (psi)" />
                                            <TextBox Name="RecircHeadPsiOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock
                                        Name="RecircNote"
                                        Margin="4,0"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border x:Name="HammerCard" Style="{StaticResource CardStyle}">
                                <StackPanel>
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Text="Water Hammer Check" />
                                    <TextBlock
                                        Margin="0,2,0,8"
                                        FontSize="12"
                                        Foreground="{StaticResource Brush.TextSubtle}"
                                        Text="Step 1: Enter line velocity and length. Step 2: Add closure time and static pressure. Step 3: Check surge and total pressure."
                                        TextWrapping="Wrap" />
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Line Velocity (ft/s)" />
                                            <TextBox Name="HammerVelocityInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Line Length (ft)" />
                                            <TextBox Name="HammerLengthInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Closure Time (s)" />
                                            <TextBox Name="HammerClosureInput" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Static Pressure (psi)" />
                                            <TextBox Name="HammerStaticInput" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <StackPanel Margin="0,4,0,8" Orientation="Horizontal">
                                        <Button
                                            Width="140"
                                            Click="BtnHammerCalc_Click"
                                            Content="Check Hammer" />
                                    </StackPanel>
                                    <UniformGrid Margin="0,4" Columns="4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Wave Speed (ft/s)" />
                                            <TextBox Name="HammerWaveSpeedOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Surge (psi)" />
                                            <TextBox Name="HammerSurgeOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Total Pressure (psi)" />
                                            <TextBox Name="HammerTotalOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock
                                        Name="HammerNote"
                                        Margin="4,0"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabItem>

            <TabItem x:Name="CatalogTab" Header="Catalogs &amp; data">
                <ScrollViewer
                    HorizontalContentAlignment="Stretch"
                    HorizontalScrollBarVisibility="Disabled"
                    PanningMode="VerticalOnly"
                    VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="12" Orientation="Vertical">
                        <TextBlock Text="Use built-in tables or point to a custom folder; built-ins stay active unless a valid catalog is loaded." TextWrapping="Wrap" />
                        <Border Style="{StaticResource AccentCardStyle}">
                            <StackPanel Orientation="Vertical">
                                <TextBlock FontWeight="Bold" Text="Custom catalog folder" />
                                <TextBlock
                                    FontSize="12"
                                    Text="Point to a folder containing materials.json/materials.csv and fittings.json/fittings.csv. Runtime files merge with the built-in ASHRAE/SMACNA/ASPE tables; invalid or missing files keep the defaults. Templates are auto-detected even if they are still named materials-template/fittings-template."
                                    TextWrapping="Wrap" />
                                <StackPanel
                                    Margin="0,2,0,0"
                                    VerticalAlignment="Center"
                                    Orientation="Horizontal">
                                    <TextBox
                                        Name="CatalogFolderText"
                                        Width="420"
                                        Margin="0,0,6,0" />
                                    <Button
                                        Width="80"
                                        Margin="0,0,6,0"
                                        Click="BrowseCatalogFolder_Click"
                                        Content="Browse"
                                        Style="{StaticResource BaseButtonStyle}" />
                                    <Button
                                        Width="130"
                                        Click="ReloadCatalogs_Click"
                                        Content="Reload Catalogs"
                                        Style="{StaticResource BaseButtonStyle}" />
                                </StackPanel>
                                <StackPanel Margin="0,6,0,0" Orientation="Horizontal">
                                    <Button
                                        Width="140"
                                        Margin="0,0,8,0"
                                        Click="ResetCatalogs_Click"
                                        Content="Reset to built-ins" />
                                    <Button
                                        Width="170"
                                        Margin="0,0,8,0"
                                        Click="CreateCatalogTemplates_Click"
                                        Content="Create template files" />
                                    <Button
                                        Width="160"
                                        Click="OpenCatalogFolder_Click"
                                        Content="Open catalog folder" />
                                </StackPanel>
                                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                    <Border
                                        Name="CatalogStatusBadge"
                                        Background="{StaticResource Brush.ChipInfoBackground}"
                                        BorderBrush="{StaticResource Brush.ChipInfoBorder}"
                                        Style="{StaticResource BadgeBorderStyle}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock
                                                Name="CatalogStatusIcon"
                                                Margin="0,0,6,0"
                                                FontWeight="Bold"
                                                Text="ℹ" />
                                            <TextBlock
                                                Name="CatalogStatusTitle"
                                                FontWeight="SemiBold"
                                                Text="Catalog status" />
                                        </StackPanel>
                                    </Border>
                                    <TextBlock
                                        Name="CatalogStatusNote"
                                        Width="580"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                                <TextBlock
                                    Name="CatalogHelperText"
                                    FontSize="12"
                                    Foreground="{StaticResource Brush.TextSubtle}"
                                    TextWrapping="Wrap" />

                                <UniformGrid Margin="0,8,0,0" Columns="2">
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock FontWeight="SemiBold" Text="Detected catalog files" />
                                        <TextBlock
                                            FontSize="11"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Helps verify the folder you picked has the right files and timestamps." />
                                        <ListBox
                                            Height="120"
                                            Margin="0,4,0,0"
                                            ItemsSource="{Binding CatalogFiles}" />
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock FontWeight="SemiBold" Text="Loaded catalog preview" />
                                        <TextBlock
                                            FontSize="11"
                                            Foreground="{StaticResource Brush.TextSubtle}"
                                            Text="Shows what actually loaded into the app after validation." />
                                        <ListBox
                                            Height="120"
                                            Margin="0,4,0,0"
                                            ItemsSource="{Binding CatalogPreview}" />
                                    </StackPanel>
                                </UniformGrid>

                                <UniformGrid Margin="0,6,0,0" Columns="2">
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock FontWeight="SemiBold" Text="Warnings" />
                                        <ItemsControl ItemsSource="{Binding CatalogWarnings}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Margin="0,2,0,0" Orientation="Horizontal">
                                                        <TextBlock Margin="0,0,6,0" Text="⚠" />
                                                        <TextBlock
                                                            Width="260"
                                                            Text="{Binding}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock FontWeight="SemiBold" Text="Errors" />
                                        <ItemsControl ItemsSource="{Binding CatalogErrors}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Margin="0,2,0,0" Orientation="Horizontal">
                                                        <TextBlock Margin="0,0,6,0" Text="⛔" />
                                                        <TextBlock
                                                            Width="260"
                                                            Text="{Binding}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </UniformGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
