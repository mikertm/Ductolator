<Window x:Class="RTM.Ductolator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Super Ductolator &amp; Plumbing Sizer" Height="720" Width="1200"
        WindowStartupLocation="CenterScreen"
        Closing="MainWindow_Closing"
        Background="{StaticResource Brush.AppBackground}">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock Text="ASHRAE/SMACNA duct sizing and ASPE/UPC plumbing calculations"
                   FontSize="16" FontWeight="Bold"/>

        <Border Grid.Row="1" Margin="0,8,0,4" Padding="8" Background="{StaticResource Brush.SurfaceAlt}" BorderBrush="{StaticResource Brush.BorderMuted}" BorderThickness="1" CornerRadius="8">
            <DockPanel LastChildFill="False">
                <StackPanel DockPanel.Dock="Left" Orientation="Vertical" VerticalAlignment="Center">
                    <TextBlock Text="Catalog source" FontWeight="SemiBold" FontSize="13" />
                    <TextBlock Name="CatalogStatusSummary" TextWrapping="Wrap" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" />
                </StackPanel>
                <Button Content="Manage catalogs" MinWidth="140" HorizontalAlignment="Right" DockPanel.Dock="Right" Click="OpenCatalogSettings_Click" Style="{StaticResource BaseButtonStyle}" />
            </DockPanel>
        </Border>

        <TabControl x:Name="MainTabs" Grid.Row="2" Margin="0,12,0,0">
            <TabItem Header="Duct Sizing">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*" />
                        <ColumnDefinition Width="2.5*" />
                    </Grid.ColumnDefinitions>

                        <Border Grid.Row="0" Grid.ColumnSpan="2" Margin="4" Padding="10" Style="{StaticResource SuccessBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="How to use" FontWeight="Bold" />
                                <TextBlock x:Name="HowToUseStep1" TextWrapping="Wrap" FontSize="12" Text="1) Enter any two of flow, velocity, or friction plus one geometry (round or rectangular) to solve the rest." />
                                <TextBlock x:Name="HowToUseStep2" TextWrapping="Wrap" FontSize="12" Text="2) Choose a code region to pull in common velocity and friction guidance." />
                                <TextBlock x:Name="HowToUseStep3" TextWrapping="Wrap" FontSize="12" Text="3) Click Calculate to fill air properties, pressure class, and equivalent shapes; Export saves the latest result to CSV." />
                            </StackPanel>
                        </Border>

                    <ScrollViewer Grid.Row="1" Grid.Column="0" Margin="0,8,12,0" VerticalScrollBarVisibility="Auto">
                        <StackPanel Orientation="Vertical" VerticalAlignment="Stretch" Panel.ZIndex="1">
                            <TextBlock Text="Plan" FontWeight="Bold" FontSize="15" Margin="4,0,4,6" />

                            <Border Margin="0,0,0,10" Padding="8" Background="{StaticResource Brush.EmphasisBackground}" BorderBrush="{StaticResource Brush.BorderAlt}" BorderThickness="1" CornerRadius="8">
                                <StackPanel Orientation="Vertical">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <Button Name="BtnCalc" Content="Calculate" Width="120" Click="BtnCalc_Click" Margin="0,0,8,0" Style="{StaticResource PrimaryButtonStyle}" />
                                        <Button Name="BtnClear" Content="Clear" Width="90" Click="BtnClear_Click" Margin="0,0,8,0" />
                                        <Button Name="BtnExportDuct" Content="Export to CSV" Width="150" Click="BtnExportDuct_Click" />
                                    </StackPanel>
                                    <TextBlock Text="Quick actions stay here so you don't have to scroll after entering inputs." FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Margin="2,6,0,0" />
                                </StackPanel>
                            </Border>

                            <Border Margin="0,0,0,12" Padding="8" Style="{StaticResource HighlightBorderStyle}">
                                <Expander IsExpanded="True">
                                    <Expander.Header>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="Quick start" VerticalAlignment="Center" />
                                            <CheckBox x:Name="NoviceModeToggle" Content="Novice mode" Margin="12,0,0,0" VerticalAlignment="Center" Checked="NoviceModeToggle_Checked" Unchecked="NoviceModeToggle_Unchecked" />
                                        </StackPanel>
                                    </Expander.Header>
                                    <StackPanel Margin="0,2,0,0" Orientation="Vertical" Panel.ZIndex="1">
                                        <TextBlock x:Name="QuickStartNoteText" TextWrapping="Wrap" FontSize="12" Margin="0,2,0,8" Text="Use this for typical sizing: enter any two of flow, velocity, or friction plus one shape (round or rectangular) to solve the rest." />
                                        <Grid Margin="0,0,0,6">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="2*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>

                                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="4" Orientation="Vertical">
                                                <TextBlock x:Name="FlowLabel" Text="Flow (CFM)" />
                                                <TextBox Name="InCfm" ToolTip="Cubic feet per minute (ft³/min)" MinWidth="150" />
                                                <TextBlock x:Name="FlowExample" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Text="Office branch: ~1,000 cfm" />
                                                <WrapPanel>
                                                    <Border Style="{StaticResource ChipBorderStyle}">
                                                        <TextBlock Text="Terminals 300–1,200 CFM" FontSize="11" />
                                                    </Border>
                                                    <Border Style="{StaticResource ChipBorderStyle}">
                                                        <TextBlock Text="Mains 1,500–8,000 CFM" FontSize="11" />
                                                    </Border>
                                                </WrapPanel>
                                            </StackPanel>
                                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="4" Orientation="Vertical">
                                                <TextBlock x:Name="VelocityLabel" Text="Velocity (FPM)" />
                                                <TextBox Name="InVel" ToolTip="Feet per minute; common supply 800–1800 fpm, returns 700–1200 fpm" MinWidth="150" />
                                                <TextBlock x:Name="VelocityExample" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Text="Typical supply: 800–1800 ft/min" />
                                                <WrapPanel>
                                                    <Border Style="{StaticResource ChipBorderStyle}">
                                                        <TextBlock Text="Supply 800–1800 FPM" FontSize="11" />
                                                    </Border>
                                                    <Border Style="{StaticResource ChipBorderStyle}">
                                                        <TextBlock Text="Return 700–1200 FPM" FontSize="11" />
                                                    </Border>
                                                </WrapPanel>
                                            </StackPanel>
                                            <StackPanel Grid.Row="0" Grid.Column="2" Margin="4" Orientation="Vertical">
                                                <TextBlock x:Name="FrictionLabel" Text="Friction (in. w.g. / 100 ft)" />
                                                <TextBox Name="InDp100" ToolTip="Inches of water per 100 ft; equal-friction duct design often 0.05–0.1" MinWidth="150" />
                                                <TextBlock x:Name="FrictionExample" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Text="Aim for 0.05–0.08 in. drop per 100 ft" />
                                                <WrapPanel>
                                                    <Border Style="{StaticResource ChipBorderStyle}">
                                                        <TextBlock Text="Equal-friction 0.05–0.10" FontSize="11" />
                                                    </Border>
                                                    <Border Style="{StaticResource ChipBorderStyle}">
                                                        <TextBlock Text="Quiet zones ≤0.08" FontSize="11" />
                                                    </Border>
                                                </WrapPanel>
                                            </StackPanel>
                                            <StackPanel Grid.Row="0" Grid.Column="3" Margin="4" Orientation="Vertical">
                                                <TextBlock x:Name="AspectRatioLabel" Text="Aspect Ratio (long/short)" />
                                                <TextBox Name="InAR" ToolTip="Dimensionless; use ≥1 (e.g., 2 = 2:1 rectangle)" MinWidth="150" />
                                                <TextBlock x:Name="AspectRatioExample" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Text="Keep it at 4:1 or lower for noise" />
                                                <WrapPanel>
                                                    <Border Style="{StaticResource ChipBorderStyle}">
                                                        <TextBlock Text="Noise-friendly ≤4:1" FontSize="11" />
                                                    </Border>
                                                </WrapPanel>
                                            </StackPanel>

                                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="4" Orientation="Vertical">
                                                <TextBlock x:Name="RoundDiameterLabel" Text="Round Diameter (in)" />
                                                <TextBox Name="InDia" ToolTip="Inside diameter in inches" MinWidth="150" />
                                                <TextBlock x:Name="RoundDiameterExample" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Text="Example: 18 in round main" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="4" Orientation="Vertical">
                                                <TextBlock x:Name="RectSide1Label" Text="Rect Side 1 (in)" />
                                                <TextBox Name="InS1" ToolTip="Long side in inches" MinWidth="150" />
                                                <TextBlock x:Name="RectSide1Example" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Text="Example: 24 in long side" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="1" Grid.Column="2" Margin="4" Orientation="Vertical">
                                                <TextBlock x:Name="RectSide2Label" Text="Rect Side 2 (in)" />
                                                <TextBox Name="InS2" ToolTip="Short side in inches" MinWidth="150" />
                                                <TextBlock x:Name="RectSide2Example" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Text="Example: 12 in short side" />
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </Expander>
                            </Border>

                            <Border Margin="0,0,0,12" Padding="8" Style="{StaticResource AccentBorderStyle}">
                                <Expander Header="Advanced" IsExpanded="False">
                                    <StackPanel Orientation="Vertical" Margin="0,2,0,0">
                                        <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,2,0,8"
                                                   Text="Use when you need site-specific corrections, leakage pressure class inputs, or thermal/insulation checks." />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="2*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>

                                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Air Temp (°F)" />
                                                <TextBox Name="InAirTemp" ToolTip="Dry-bulb air temperature in °F; used for density/viscosity" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Altitude (ft)" />
                                                <TextBox Name="InAltitude" ToolTip="Site elevation above sea level in feet" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="0" Grid.Column="2" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Straight Length (ft)" />
                                                <TextBox Name="InLength" ToolTip="Length of straight duct run used for frictional drop" TextChanged="InLength_TextChanged" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="0" Grid.Column="3" Margin="4" Orientation="Vertical">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <TextBlock Text="Fitting loss sum (K)" />
                                                    <TextBlock Text="ℹ" Foreground="{StaticResource Brush.TextSubtle}" FontSize="12" Margin="6,0,0,0"
                                                               ToolTip="Sum of loss coefficients from fittings; higher totals increase pressure drop." />
                                                </StackPanel>
                                                <TextBox Name="InLossCoeff" ToolTip="Sum of fitting loss coefficients (dimensionless); higher values add more static loss." />
                                            </StackPanel>

                                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Supply Static (in. w.g.)" />
                                                <TextBox Name="InSupplyStatic" ToolTip="Design supply fan static pressure in inches of water" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Return/Exhaust Static (in. w.g.)" />
                                                <TextBox Name="InReturnStatic" ToolTip="Return or exhaust static pressure in inches of water" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="1" Grid.Column="2" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Leakage Class (cfm/100ft² @1in)" />
                                                <TextBox Name="InLeakageClass" ToolTip="SMACNA leakage class (3, 6, 12, 24). Default 6" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="1" Grid.Column="3" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Leak Test Pressure (in. w.g.)" />
                                                <TextBox Name="InLeakTestPressure" ToolTip="Test pressure for leakage calc; often design static" />
                                            </StackPanel>

                                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Fan Efficiency (0-1)" />
                                                <TextBox Name="InFanEff" ToolTip="Total-to-static fan efficiency as a decimal (e.g., 0.65)" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Ambient Temp (°F)" />
                                                <TextBox Name="InAmbientTemp" ToolTip="Surrounding ambient temperature for heat gain/loss" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="2" Grid.Column="2" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Max Allowable ΔT (°F)" />
                                                <TextBox Name="InMaxDeltaT" ToolTip="Allowed supply temperature drop across the run" />
                                            </StackPanel>
                                            <StackPanel Grid.Row="2" Grid.Column="3" Margin="4" Orientation="Vertical">
                                                <TextBlock Text="Existing Insulation R" />
                                                <TextBox Name="InExistingInsulR" ToolTip="Installed insulation R (hr·ft²·°F/Btu) if known" />
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </Expander>
                            </Border>

                            <Border Margin="0,0,0,12" Padding="10" Style="{StaticResource HighlightBorderStyle}">
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="Regional presets" FontWeight="Bold" />
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,2,0,6">
                                        <TextBlock Text="Code Region" VerticalAlignment="Center" Margin="0,0,8,0" />
                                        <ComboBox Name="DuctRegionCombo" Width="260" />
                                    </StackPanel>
                                    <WrapPanel Margin="0,2,0,0" HorizontalAlignment="Left">
                                        <Button Style="{StaticResource PillButtonStyle}" Content="Supply main preset" Tag="Supply" Margin="0,0,10,8" Click="ApplyVelocityPreset_Click" />
                                        <Button Style="{StaticResource PillButtonStyle}" Content="Branch preset" Tag="Branch" Margin="0,0,10,8" Click="ApplyVelocityPreset_Click" />
                                        <Button Style="{StaticResource PillButtonStyle}" Content="Return/exhaust preset" Tag="Return" Margin="0,0,10,8" Click="ApplyVelocityPreset_Click" />
                                    </WrapPanel>
                                    <TextBlock Text="Presets drop region-specific ASHRAE/SMACNA velocity caps and default friction into the inputs." FontSize="12" TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border Margin="0,0,0,12" Padding="8" Style="{StaticResource HighlightBorderStyle}">
                                <StackPanel>
                                    <TextBlock Text="Fittings (ASHRAE/SMACNA)" FontWeight="Bold" />
                                    <UniformGrid Columns="3" Margin="0,4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Fitting" />
                                            <ComboBox Name="DuctFittingCombo" DisplayMemberPath="Name" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Quantity" />
                                            <TextBox Name="DuctFittingQty" Text="1" />
                                        </StackPanel>
                                        <StackPanel Margin="4" Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Left">
                                            <Button Content="Add" Width="60" Click="AddDuctFitting_Click" Margin="0,0,6,0" />
                                            <Button Content="Remove" Width="70" Click="RemoveDuctFitting_Click" Margin="0,0,6,0" />
                                            <Button Content="Clear" Width="60" Click="ClearDuctFittings_Click" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock Text="Select a fitting, enter quantity, then Add; totals refresh below"
                                               Margin="4,0,4,6" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" />
                                    <Grid Margin="4,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ListBox Name="DuctFittingRunList" Height="120" Grid.Column="0" />
                                        <Border Grid.Column="1" Margin="8,0,0,0" Padding="10,6" Background="{StaticResource Brush.EmphasisBackground}" BorderBrush="{StaticResource Brush.BorderAlt}" BorderThickness="1" CornerRadius="8">
                                            <TextBlock Name="DuctFittingBadgeText" VerticalAlignment="Center" TextWrapping="Wrap" />
                                        </Border>
                                    </Grid>
                                    <UniformGrid Columns="3" Margin="0,4">
                                        <StackPanel Margin="4">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <TextBlock Text="Fitting loss sum (K)" />
                                                <TextBlock Text="ℹ" Foreground="{StaticResource Brush.TextSubtle}" FontSize="12" Margin="6,0,0,0"
                                                           ToolTip="Total K for the run; higher sums raise pressure drop." />
                                            </StackPanel>
                                            <TextBox Name="DuctFittingSumKOutput" IsReadOnly="True"
                                                     ToolTip="Total K value from fittings; higher totals increase pressure drop." />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Equivalent length (ft)" />
                                            <TextBox Name="DuctFittingEquivalentLengthOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Total run length (ft)" />
                                            <TextBox Name="DuctTotalRunLengthOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock Name="DuctFittingSummaryText" Margin="4,2,4,0" TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border Margin="0,0,0,10" Padding="8" Style="{StaticResource HighlightBorderStyle}">
                                <StackPanel>
                                    <TextBlock Text="Input tips" FontWeight="Bold" />
                                    <TextBlock x:Name="InputTipsLine1" TextWrapping="Wrap" FontSize="12" Text="Enter CFM (ft³/min), velocity (ft/min), friction (in. w.g. per 100 ft), dimensions in inches, and lengths in feet. You can size with diameter, rectangle, or flow+velocity combinations." />
                                    <TextBlock x:Name="InputTipsLine2" TextWrapping="Wrap" FontSize="12" Text="Air temp (°F) and altitude (ft) tune density/viscosity for non-standard air. Reynolds number highlights laminar vs. turbulent flow, and the Darcy friction factor (f) feeds total pressure. Straight length and fitting loss sum add fittings to total pressure." />
                                </StackPanel>
                            </Border>

                            <TextBlock Name="DuctCodeNote" Margin="4,0" TextWrapping="Wrap" />
                            <TextBlock Name="DuctStatusNote" Margin="4,0,4,8" TextWrapping="Wrap" Foreground="{StaticResource Brush.TextDanger}" />
                        </StackPanel>
                    </ScrollViewer>

                    <ScrollViewer Grid.Row="1" Grid.Column="1" Margin="0,8,4,0" VerticalScrollBarVisibility="Auto">
                        <Border Padding="12" Background="{StaticResource Brush.SurfaceAlt}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="10">
                            <StackPanel Orientation="Vertical">
                                <TextBlock Text="Results" FontWeight="Bold" FontSize="15" Margin="0,0,0,6" />

                                <UniformGrid Columns="4" Margin="0,0,0,10">
                                    <Border Margin="4" Padding="10" Style="{StaticResource HighlightBorderStyle}" CornerRadius="12" MinHeight="120">
                                        <StackPanel>
                                            <TextBlock Text="Velocity" FontWeight="Bold" />
                                            <TextBox Name="OutVel" IsReadOnly="True" Margin="0,4,0,2" />
                                            <WrapPanel>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock Text="Code caps via region" FontSize="11" />
                                                </Border>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock Text="Supply 800–1800" FontSize="11" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                    </Border>
                                    <Border Margin="4" Padding="10" Style="{StaticResource SuccessBorderStyle}" CornerRadius="12" MinHeight="120">
                                        <StackPanel>
                                            <TextBlock Text="Friction" FontWeight="Bold" />
                                            <TextBox Name="OutDp100" IsReadOnly="True" Margin="0,4,0,2" />
                                            <WrapPanel>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock Text="Equal-friction 0.05–0.10" FontSize="11" />
                                                </Border>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock Text="Quiet ≤0.08" FontSize="11" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                    </Border>
                                    <Border Margin="4" Padding="10" Style="{StaticResource WarningBorderStyle}" CornerRadius="12" MinHeight="120">
                                        <StackPanel>
                                            <TextBlock Text="Total ΔP" FontWeight="Bold" />
                                            <TextBox Name="OutTotalDp" IsReadOnly="True" Margin="0,4,0,2" />
                                            <WrapPanel>
                                                <Border Style="{StaticResource ChipBorderStyle}">
                                                    <TextBlock Text="Includes fittings" FontSize="11" />
                                                </Border>
                                            </WrapPanel>
                                        </StackPanel>
                                    </Border>
                                </UniformGrid>

                                <UniformGrid Columns="2" Margin="0,0,0,6">
                                    <Border Margin="4" Padding="10" Style="{StaticResource HighlightBorderStyle}" CornerRadius="12" MinHeight="140">
                                        <StackPanel>
                                            <TextBlock Text="Air Data" FontWeight="Bold" />
                                            <UniformGrid Columns="2" Margin="0,6,0,0">
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="CFM (ft³/min)" />
                                                    <TextBox Name="OutCfm" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Reynolds (Re)" />
                                                    <TextBox Name="OutRe" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Friction Factor (f)" />
                                                    <TextBox Name="OutF" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Velocity Pressure (in. w.g.)" />
                                                    <TextBox Name="OutVp" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Density (lbm/ft³)" />
                                                    <TextBox Name="OutAirDensity" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Kinematic Viscosity (ft²/s)" />
                                                    <TextBox Name="OutAirNu" IsReadOnly="True" />
                                                </StackPanel>
                                            </UniformGrid>
                                        </StackPanel>
                                    </Border>

                                    <Border Margin="4" Padding="10" Style="{StaticResource WarningBorderStyle}" CornerRadius="12" MinHeight="140">
                                        <StackPanel>
                                            <TextBlock Text="Pressure / Leakage / Fan" FontWeight="Bold" />
                                            <UniformGrid Columns="2" Margin="0,6,0,0">
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Pressure Class (in. w.g.)" />
                                                    <TextBox Name="OutPressureClass" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Leakage (cfm)" />
                                                    <TextBox Name="OutLeakage" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Fan BHP" />
                                                    <TextBox Name="OutFanBhp" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                <TextBlock Text="Velocity Pressure (check)" />
                                                <TextBox Name="OutVpEcho" IsReadOnly="True"
                                                         ToolTip="Echo of velocity pressure for quick fan and pressure class checks." />
                                                </StackPanel>
                                            </UniformGrid>
                                        </StackPanel>
                                    </Border>

                                    <Border Margin="4" Padding="10" Style="{StaticResource SuccessBorderStyle}" CornerRadius="12">
                                        <StackPanel>
                                            <TextBlock Text="Heat / Insulation" FontWeight="Bold" />
                                            <UniformGrid Columns="2" Margin="0,6,0,0">
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Heat Transfer (Btuh)" />
                                                    <TextBox Name="OutHeatTransfer" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Supply ΔT (°F)" />
                                                    <TextBox Name="OutDeltaT" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Needed Insul R" />
                                                    <TextBox Name="OutRequiredR" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Est. Thickness (in)" />
                                                    <TextBox Name="OutInsulThk" IsReadOnly="True" />
                                                </StackPanel>
                                            </UniformGrid>
                                        </StackPanel>
                                    </Border>

                                    <Border Margin="4" Padding="10" Style="{StaticResource MutedBorderStyle}" CornerRadius="12">
                                        <StackPanel>
                                            <TextBlock Text="Geometry" FontWeight="Bold" />
                                            <UniformGrid Columns="3" Margin="0,6,0,0">
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Round Dia (in)" />
                                                    <TextBox Name="OutDia" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Rect Side 1 (in)" />
                                                    <TextBox Name="OutRS1" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Rect Side 2 (in)" />
                                                    <TextBox Name="OutRS2" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Oval Major (in)" />
                                                    <TextBox Name="OutOS1" IsReadOnly="True" />
                                                </StackPanel>
                                                <StackPanel Margin="4">
                                                    <TextBlock Text="Oval Minor (in)" />
                                                    <TextBox Name="OutOS2" IsReadOnly="True" />
                                                </StackPanel>
                                            </UniformGrid>
                                            <StackPanel Margin="0,6,0,0">
                                                <Expander Header="Round details" Margin="0,4,0,0">
                                                    <UniformGrid Columns="2" Margin="0,6,0,0">
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Area (ft²)" />
                                                            <TextBox Name="OutAreaRound" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Circumference (ft)" />
                                                            <TextBox Name="OutCircRound" IsReadOnly="True" />
                                                        </StackPanel>
                                                    </UniformGrid>
                                                </Expander>
                                                <Expander Header="Rectangular details" Margin="0,4,0,0">
                                                    <UniformGrid Columns="3" Margin="0,6,0,0">
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Aspect Ratio" />
                                                            <TextBox Name="OutRAR" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Area (ft²)" />
                                                            <TextBox Name="OutRArea" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Perimeter (ft)" />
                                                            <TextBox Name="OutRPerim" IsReadOnly="True" />
                                                        </StackPanel>
                                                    </UniformGrid>
                                                </Expander>
                                                <Expander Header="Flat oval details" Margin="0,4,0,0">
                                                    <UniformGrid Columns="3" Margin="0,6,0,0">
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Aspect Ratio" />
                                                            <TextBox Name="OutOAR" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Area (ft²)" />
                                                            <TextBox Name="OutOArea" IsReadOnly="True" />
                                                        </StackPanel>
                                                        <StackPanel Margin="4">
                                                            <TextBlock Text="Perimeter (ft)" />
                                                            <TextBox Name="OutOPerim" IsReadOnly="True" />
                                                        </StackPanel>
                                                    </UniformGrid>
                                                </Expander>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </UniformGrid>
                            </StackPanel>
                        </Border>
                </ScrollViewer>
                </Grid>
            </TabItem>

            <TabItem Header="Plumbing">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Margin="8" Padding="10" Style="{StaticResource CardBorderStyle}" Background="{StaticResource Brush.SurfaceAlt}" BorderBrush="{StaticResource Brush.Border}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Plumbing Guide" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,4,0,8"
                                       Text="Jump between cards and follow the quick steps in each section." />
                            <StackPanel>
                                <Button Content="Loss" Tag="{x:Reference LossCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                                <Button Content="Target Friction" Tag="{x:Reference TargetFrictionCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                                <Button Content="Fixture Units" Tag="{x:Reference FixtureUnitsCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                                <Button Content="Sanitary" Tag="{x:Reference SanitaryCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                                <Button Content="Stormwater" Tag="{x:Reference StormwaterCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                                <Button Content="Natural Gas" Tag="{x:Reference GasCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                                <Button Content="DHW Recirc" Tag="{x:Reference RecircCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                                <Button Content="Water Hammer" Tag="{x:Reference HammerCard}" Click="NavigateToCard_Click" Margin="0,4,0,0" Style="{StaticResource PillButtonStyle}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="8" Orientation="Vertical">
                            <Border Margin="4" Padding="12" Style="{StaticResource WarningBorderStyle}" CornerRadius="10">
                                <StackPanel>
                                    <TextBlock Text="Plumbing overview" FontWeight="Bold" />
                                    <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,2,0,4"
                                               Text="Use the cards below to size supply, drainage, and specialty piping. Each card lists the quick steps to stay on track." />
                                    <WrapPanel>
                                        <Border Style="{StaticResource ChipBorderStyle}">
                                            <TextBlock Text="UPC: ≤10 ft/s cold, ≤8 ft/s hot" FontSize="11" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}">
                                            <TextBlock Text="ASPE: target 2–8 ft/s" FontSize="11" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}">
                                            <TextBlock Text="Fixture-unit guardrails per IPC/UPC tables" FontSize="11" />
                                        </Border>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>
    
                    <Border x:Name="LossCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource WarningBorderStyle}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Loss" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter flow, length, and nominal size or explicit ID with material and fluid details. Step 2: Pick a region and add fittings. Step 3: Calculate loss, clear, or export." />
                            <TextBlock Text="Pipe Conditions" FontWeight="Bold" />
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Flow (gpm)" />
                                    <TextBox Name="PlGpmInput" ToolTip="Gallons per minute" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Length (ft)" />
                                    <TextBox Name="PlLengthInput" ToolTip="Straight length for friction in feet" TextChanged="PlLengthInput_TextChanged" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Nominal Size (in)" />
                                    <TextBox Name="PlNominalInput" ToolTip="Nominal trade size in inches" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Explicit ID (in)" />
                                    <TextBox Name="PlExplicitIdInput" ToolTip="Override with an inside diameter in inches" />
                                </StackPanel>
                            </UniformGrid>
    
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Material" />
                                    <ComboBox Name="PlMaterialCombo" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <CheckBox Name="PlUseAgedC" Content="Use aged C-factor" />
                                    <CheckBox Name="PlIsHotWater" Content="Hot water (velocity check)" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Fluid" />
                                    <ComboBox Name="PlAntifreezeTypeCombo" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Fluid Temp (°F)" />
                                    <TextBox Name="PlFluidTempInput" ToolTip="Temperature of the fluid stream in °F" />
                                </StackPanel>
                            </UniformGrid>
    
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Antifreeze %" />
                                    <TextBox Name="PlAntifreezePercentInput" ToolTip="Percentage of glycol by volume (0–60%)" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Available head / pump duty (psi)" />
                                    <StackPanel Orientation="Horizontal">
                                        <TextBox Name="PlAvailableHeadPsiInput" ToolTip="Available head or boost pressure in psi" Width="130" />
                                        <TextBlock Text="psi" Margin="6,0,0,0" VerticalAlignment="Center" />
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Available head / pump duty (ft head)" />
                                    <StackPanel Orientation="Horizontal">
                                        <TextBox Name="PlAvailableHeadFtInput" ToolTip="Available head or pump duty in feet of head" Width="130" />
                                        <TextBlock Text="ft head" Margin="6,0,0,0" VerticalAlignment="Center" />
                                    </StackPanel>
                                </StackPanel>
                            </UniformGrid>
    
                            <StackPanel Orientation="Horizontal" Margin="4,4,4,0" VerticalAlignment="Center">
                                <TextBlock Text="Code Region" VerticalAlignment="Center" Margin="0,0,8,0" />
                                <ComboBox Name="PlRegionCombo" Width="260" />
                            </StackPanel>

                            <Border Margin="4,8,4,4" Padding="8" Background="{StaticResource Brush.EmphasisBackground}" BorderBrush="{StaticResource Brush.BorderAlt}" BorderThickness="1" CornerRadius="8">
                                <StackPanel Orientation="Vertical">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <Button Content="Calculate Loss" Width="150" Click="BtnPlCalc_Click" Margin="0,0,8,0" Style="{StaticResource PrimaryButtonStyle}" />
                                        <Button Content="Clear" Width="90" Click="BtnPlClear_Click" Margin="0,0,8,0" />
                                        <Button Content="Export to CSV" Width="150" Click="BtnExportPlumbing_Click" />
                                    </StackPanel>
                                    <TextBlock Text="Run, reset, or export results without scrolling; you can still use the fitting tools below." FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" Margin="2,6,0,0" />
                                </StackPanel>
                            </Border>
    
                            <Border Margin="4" Padding="8" Style="{StaticResource HighlightBorderStyle}" CornerRadius="8">
                                <StackPanel>
                                    <TextBlock Text="Fittings (ASPE/UPC)" FontWeight="Bold" />
                                    <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,6"
                                               Text="Step 2 helper: select a fitting, add quantities, and review equivalent lengths." />
                                    <UniformGrid Columns="3" Margin="0,4">
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Fitting" />
                                            <ComboBox Name="PlFittingCombo" DisplayMemberPath="Name" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Qty" />
                                            <TextBox Name="PlFittingQty" />
                                        </StackPanel>
                                        <StackPanel Margin="4" Orientation="Horizontal" VerticalAlignment="Bottom">
                                            <Button Content="Add" Width="60" Click="AddPlumbingFitting_Click" Margin="0,0,6,0" />
                                            <Button Content="Remove" Width="70" Click="RemovePlumbingFitting_Click" Margin="0,0,6,0" />
                                            <Button Content="Clear" Width="60" Click="ClearPlumbingFittings_Click" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock Text="Fittings use ASPE K factors and UPC equivalent length guidance." Margin="4,0,4,2" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" />
                                    <TextBlock Text="Needs fitting + qty; outputs fitting loss sum (K) and equivalent length." Margin="4,0,4,6" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" />
                                    <Grid Margin="4,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ListBox Name="PlFittingRunList" Height="120" Grid.Column="0" />
                                        <Border Grid.Column="1" Margin="8,0,0,0" Padding="10,6" Background="{StaticResource Brush.EmphasisBackground}" BorderBrush="{StaticResource Brush.BorderAlt}" BorderThickness="1" CornerRadius="8">
                                            <TextBlock Name="PlFittingBadgeText" VerticalAlignment="Center" TextWrapping="Wrap" />
                                        </Border>
                                    </Grid>
                                    <UniformGrid Columns="3" Margin="0,4">
                                        <StackPanel Margin="4">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <TextBlock Text="Fitting loss sum (K)" />
                                                <TextBlock Text="ℹ" Foreground="{StaticResource Brush.TextSubtle}" FontSize="12" Margin="6,0,0,0"
                                                           ToolTip="Total K for the plumbing run; higher sums raise pressure drop." />
                                            </StackPanel>
                                            <TextBox Name="PlFittingSumKOutput" IsReadOnly="True"
                                                     ToolTip="Sum of plumbing fitting K values; higher totals increase pressure drop." />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Equivalent length (ft)" />
                                            <TextBox Name="PlFittingEquivalentLengthOutput" IsReadOnly="True" />
                                        </StackPanel>
                                        <StackPanel Margin="4">
                                            <TextBlock Text="Total run length (ft)" />
                                            <TextBox Name="PlTotalRunLengthOutput" IsReadOnly="True" />
                                        </StackPanel>
                                    </UniformGrid>
                                    <TextBlock Name="PlFittingSummaryText" Margin="4,2,4,0" TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>
    
                            <Border Margin="4,0,4,8" Padding="8" Style="{StaticResource WarningBorderStyle}" CornerRadius="8">
                                <StackPanel>
                                    <TextBlock Text="Input tips" FontWeight="Bold" />
                                    <TextBlock TextWrapping="Wrap" FontSize="12"
                                               Text="Enter flow in gpm, lengths in feet, nominal sizes in inches, and IDs in inches. Hazen-Williams pressure drop per 100 ft follows IPC/UPC practice; Darcy-Weisbach uses roughness from material and Re from flow." />
                                    <TextBlock TextWrapping="Wrap" FontSize="12"
                                               Text="Use the hot-water checkbox for velocity caps (cold water under 8 ft/s is a common goal), and switch to aged C-factors for conservative rehab sizing." />
                                    <TextBlock TextWrapping="Wrap" FontSize="12"
                                               Text="Fluid temperature and glycol percentage tune density/viscosity, adjust Hazen-Williams C, and slightly increase roughness for heavy mixes. Reynolds number flags laminar (&lt;2,000), transitional (≈2,000–4,000), or turbulent (&gt;4,000) flow; Darcy f typically lands 0.015–0.03 in clean, turbulent piping; higher viscosity lowers Re and raises f." />
                                </StackPanel>
                            </Border>
    
                            <TextBlock Text="Results" FontWeight="Bold" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,0,0,4"
                                       Text="After Calculate Loss, review the resolved ID, velocity, and pressure drop from your flow, length, size, material, and fittings." />
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Resolved ID (in)" />
                                    <TextBox Name="PlResolvedIdOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Velocity (ft/s)" />
                                    <TextBox Name="PlVelocityOutput" IsReadOnly="True"
                                             ToolTip="Aim under ~8 ft/s for cold domestic water; under ~5 ft/s for hot water or glycol to limit noise and erosion." />
                                    <WrapPanel>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.ChipSuccessBackground}" BorderBrush="{StaticResource Brush.ChipSuccessBorder}">
                                            <TextBlock Text="Cold water target: &lt; 8 ft/s" FontSize="11" Foreground="{StaticResource Brush.TextSuccess}" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.ChipWarningBackground}" BorderBrush="{StaticResource Brush.ChipWarningBorder}">
                                            <TextBlock Text="Hot/glycol: &lt; 5 ft/s" FontSize="11" Foreground="{StaticResource Brush.TextWarning}" />
                                        </Border>
                                    </WrapPanel>
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Reynolds Number" />
                                    <TextBox Name="PlReOutput" IsReadOnly="True"
                                             ToolTip="&lt;2,000 is laminar, 2,000–4,000 transitional, and &gt;4,000 turbulent; turbulent flow keeps Hazen-Williams and Moody charts valid." />
                                    <WrapPanel>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.ChipInfoBackground}" BorderBrush="{StaticResource Brush.ChipInfoBorder}">
                                            <TextBlock Text="Turbulent sweet spot: &gt; 4,000" FontSize="11" Foreground="{StaticResource Brush.TextInfo}" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.ChipWarningBackground}" BorderBrush="{StaticResource Brush.ChipWarningBorder}">
                                            <TextBlock Text="Transitional: 2,000–4,000" FontSize="11" Foreground="{StaticResource Brush.TextWarning}" />
                                        </Border>
                                    </WrapPanel>
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Darcy f" />
                                    <TextBox Name="PlFrictionOutput" IsReadOnly="True"
                                             ToolTip="Clean turbulent piping often yields f between 0.015–0.03; higher values signal rough pipe, low Re, or scale." />
                                    <WrapPanel>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.CardAltBackground}" BorderBrush="{StaticResource Brush.BorderAlt}">
                                            <TextBlock Text="Typical clean: 0.015–0.03" FontSize="11" Foreground="{StaticResource Brush.TextInfo}" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.ChipDangerBackground}" BorderBrush="{StaticResource Brush.ChipDangerBorder}">
                                            <TextBlock Text="High? check scale/viscosity" FontSize="11" Foreground="{StaticResource Brush.TextDangerSoft}" />
                                        </Border>
                                    </WrapPanel>
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Fluid Density (lb/ft³)" />
                                    <TextBox Name="PlFluidDensityOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Kinematic viscosity (ft²/s)" />
                                    <TextBox Name="PlFluidNuOutput" IsReadOnly="True"
                                             ToolTip="Higher viscosity lowers Reynolds number and can raise Darcy f; cooler water or glycol mixes increase viscosity." />
                                    <WrapPanel>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.ChipPurpleBackground}" BorderBrush="{StaticResource Brush.ChipPurpleBorder}">
                                            <TextBlock Text="Lower ν → higher Re" FontSize="11" Foreground="{StaticResource Brush.TextMutedStrong}" />
                                        </Border>
                                        <Border Style="{StaticResource ChipBorderStyle}" Background="{StaticResource Brush.ChipWarningBackground}" BorderBrush="{StaticResource Brush.ChipWarningBorder}">
                                            <TextBlock Text="High ν? expect higher f" FontSize="11" Foreground="{StaticResource Brush.TextWarning}" />
                                        </Border>
                                    </WrapPanel>
                                </StackPanel>
                            </UniformGrid>
    
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Hazen-Williams drop (psi/100 ft)" />
                                    <TextBox Name="PlHazenPsi100Output" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Hazen-Williams total drop (psi)" />
                                    <TextBox Name="PlHazenPsiTotalOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Darcy-Weisbach drop (psi/100 ft)" />
                                    <TextBox Name="PlDarcyPsi100Output" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Darcy-Weisbach total drop (psi)" />
                                    <TextBox Name="PlDarcyPsiTotalOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
    
                            <TextBlock Name="PlVelocityNote" Margin="4,0" TextWrapping="Wrap" />
                            <TextBlock Name="PlStatusNote" Margin="4,0,4,0" TextWrapping="Wrap" Foreground="{StaticResource Brush.TextDanger}" />
                        </StackPanel>
                    </Border>
    
                    <Border x:Name="TargetFrictionCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource HighlightBorderStyle}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Target Friction" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter flow and target pressure drop per 100 ft. Step 2: Solve the inside diameter. Step 3: Review the nearest nominal size." />
                            <TextBlock Text="Size for Target Friction" FontWeight="Bold" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,0,0,4"
                                       Text="Enter flow and a target pressure drop per 100 ft, then Solve Diameter to get an inside diameter and the nearest nominal size." />
                            <UniformGrid Columns="3" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Flow (gpm)" />
                                    <TextBox Name="PlSizeGpmInput" ToolTip="Gallons per minute" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Target drop (psi/100 ft)" />
                                    <TextBox Name="PlTargetPsi100Input" ToolTip="Pressure drop target in psi per 100 ft" />
                                </StackPanel>
                            </UniformGrid>
    
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,8" VerticalAlignment="Center">
                                <Button Content="Solve Diameter" Width="140" Click="BtnPlSize_Click" />
                                <TextBlock Text="Needs flow + target drop per 100 ft; outputs ID and nearest nominal size." Margin="8,0,0,0" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" VerticalAlignment="Center" />
                            </StackPanel>
    
                            <UniformGrid Columns="3" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Solved ID (in)" />
                                    <TextBox Name="PlSizedDiameterOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Nearest Nominal (in)" />
                                    <TextBox Name="PlSizedNominalOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
    
                            <TextBlock Name="PlSizeNote" Margin="4,0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>
    
                    <Border x:Name="FixtureUnitsCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource CardBorderStyle}" Background="{StaticResource Brush.SurfaceAlt}" BorderBrush="{StaticResource Brush.BorderMuted}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Fixture Units" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Build a fixture list. Step 2: Review the auto-summed fixture units and probable demand. Step 3: Use the demand to size branches and mains." />
                            <TextBlock Text="Fixture Units &amp; Drainage" FontWeight="Bold" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,0,0,8"
                                       Text="Select fixture types, quantities, and optional overrides. Defaults come from IPC/UPC fixture-unit tables. The schedule auto-sums total FU and probable demand." />

                            <StackPanel Margin="0,0,0,8">
                                <TextBlock Text="Custom fixture types" FontWeight="Bold" />
                                <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,0,0,4"
                                           Foreground="{StaticResource Brush.TextSubtle}"
                                           Text="Add your own fixtures with default FU values, then edit or delete them as needed." />
                                <UniformGrid Columns="3" Margin="0,0,0,6">
                                    <StackPanel Margin="4">
                                        <TextBlock Text="Fixture name" />
                                        <TextBox Name="CustomFixtureNameInput" />
                                    </StackPanel>
                                    <StackPanel Margin="4">
                                        <TextBlock Text="Default FU" />
                                        <TextBox Name="CustomFixtureFuInput" ToolTip="Default fixture units" />
                                    </StackPanel>
                                    <StackPanel Margin="4" VerticalAlignment="Bottom">
                                        <Button Content="Add Custom Fixture" Width="160" Click="AddCustomFixture_Click" />
                                    </StackPanel>
                                </UniformGrid>
                                <ItemsControl ItemsSource="{Binding CustomFixtures}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="2,4">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="3*" />
                                                    <ColumnDefinition Width="1.2*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBox Grid.Column="0" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBox Grid.Column="1" Margin="6,0,0,0" Text="{Binding FixtureUnits, UpdateSourceTrigger=PropertyChanged}" />
                                                <Button Grid.Column="2" Content="Delete" Margin="6,0,0,0" Tag="{Binding}" Click="RemoveCustomFixture_Click" />
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                                <Button Content="Add Fixture" Width="100" Click="AddFixtureRow_Click" />
                                <TextBlock Text="Use default fixture units or override when needed." Margin="8,0,0,0" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" VerticalAlignment="Center" />
                            </StackPanel>

                            <Border BorderBrush="{StaticResource Brush.BorderMuted}" BorderThickness="1" CornerRadius="8" Background="{StaticResource Brush.Surface}">
                                <StackPanel>
                                    <Grid Margin="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="3*" />
                                            <ColumnDefinition Width="1.5*" />
                                            <ColumnDefinition Width="1.4*" />
                                            <ColumnDefinition Width="1.6*" />
                                            <ColumnDefinition Width="1.5*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Fixture" FontWeight="Bold" />
                                        <TextBlock Grid.Column="1" Text="Default FU" FontWeight="Bold" />
                                        <TextBlock Grid.Column="2" Text="Quantity" FontWeight="Bold" />
                                        <TextBlock Grid.Column="3" Text="Override FU" FontWeight="Bold" />
                                        <TextBlock Grid.Column="4" Text="Row Total" FontWeight="Bold" />
                                    </Grid>
                                    <Separator />
                                    <ItemsControl ItemsSource="{Binding FixtureRows}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Margin="6">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="3*" />
                                                        <ColumnDefinition Width="1.5*" />
                                                        <ColumnDefinition Width="1.4*" />
                                                        <ColumnDefinition Width="1.6*" />
                                                        <ColumnDefinition Width="1.5*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <ComboBox Grid.Column="0"
                                                              ItemsSource="{Binding DataContext.FixtureCatalog, RelativeSource={RelativeSource AncestorType=Window}}"
                                                              DisplayMemberPath="Name"
                                                              SelectedItem="{Binding FixtureType, Mode=TwoWay}"
                                                              SelectionChanged="FixtureType_SelectionChanged" />
                                                    <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding DefaultFixtureUnits, StringFormat=0.###}" />
                                                    <TextBox Grid.Column="2" Text="{Binding QuantityText, UpdateSourceTrigger=PropertyChanged}"
                                                             ToolTip="Number of fixtures" />
                                                    <TextBox Grid.Column="3" Text="{Binding OverrideText, UpdateSourceTrigger=PropertyChanged}"
                                                             ToolTip="Optional override per-fixture FU" />
                                                    <TextBlock Grid.Column="4" VerticalAlignment="Center" Text="{Binding ResolvedFixtureUnits, StringFormat=0.###}" />
                                                    <Button Grid.Column="5" Content="Remove" Margin="6,0,0,0" Tag="{Binding}" Click="RemoveFixtureRow_Click" />
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <UniformGrid Columns="4" Margin="0,8,0,0">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Total Fixture Units" />
                                    <TextBox Name="FixtureUnitsInput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <Button Content="Calc Hunter Demand" Width="160" Click="BtnFixtureDemand_Click" />
                                    <TextBlock Text="Auto-updates when fixtures change." Margin="8,0,0,0" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" VerticalAlignment="Center" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Probable Demand (gpm)" />
                                    <TextBox Name="FixtureDemandOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                        </StackPanel>
                    </Border>
    
                    <Border x:Name="SanitaryCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource WarningBorderStyle}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Sanitary" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter DFU and slope. Step 2: Size for minimum diameter. Step 3: Check allowable DFU for existing sizes." />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,0,0,4"
                                       Text="Enter DFU and slope, then Size Sanitary to get a minimum diameter or check allowable DFU at a chosen size." />

                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Sanitary DFU" />
                                    <TextBox Name="SanitaryDfuInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Slope (ft/ft)" />
                                    <TextBox Name="SanitarySlopeInput" />
                                </StackPanel>
                                <StackPanel Margin="4" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <Button Content="Size Sanitary" Width="140" Click="BtnSanitarySize_Click" />
                                    <TextBlock Text="Needs DFU + slope; outputs minimum diameter." Margin="8,0,0,0" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" VerticalAlignment="Center" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Min Diameter (in)" />
                                    <TextBox Name="SanitaryDiameterOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Check DFU @ Dia" />
                                    <TextBox Name="SanitaryCheckDiameterInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Slope (ft/ft)" />
                                    <TextBox Name="SanitaryCheckSlopeInput" />
                                </StackPanel>
                                <StackPanel Margin="4" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <Button Content="Allowable DFU" Width="140" Click="BtnSanitaryAllowable_Click" />
                                    <TextBlock Text="Needs diameter + slope; outputs allowable DFU." Margin="8,0,0,0" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" VerticalAlignment="Center" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Allowable DFU" />
                                    <TextBox Name="SanitaryAllowableOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                            <TextBlock Name="SanitaryNote" Margin="4,0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>

                    <Border x:Name="VentStackCard" Margin="0,0,0,10" Padding="12" Background="{StaticResource Brush.EmphasisBackground}" BorderBrush="{StaticResource Brush.BorderAlt}" BorderThickness="1" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Vent Stack" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter vented DFU and developed length, then size the vent stack. Step 2: Check allowable DFU for an existing vent size." />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,0,0,4"
                                       Text="Enter vented DFU and developed length to size a vent stack, or check allowable DFU at a given vent diameter and length." />

                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Vented DFU" />
                                    <TextBox Name="VentDfuInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Vent Length (ft)" />
                                    <TextBox Name="VentLengthInput" />
                                </StackPanel>
                                <StackPanel Margin="4" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <Button Content="Size Vent Stack" Width="140" Click="BtnVentSize_Click" />
                                    <TextBlock Text="Needs vent DFU + length; outputs vent diameter." Margin="8,0,0,0" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" VerticalAlignment="Center" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Vent Diameter (in)" />
                                    <TextBox Name="VentDiameterOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Check Vent Dia (in)" />
                                    <TextBox Name="VentDiameterCheckInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Developed Length (ft)" />
                                    <TextBox Name="VentLengthCheckInput" />
                                </StackPanel>
                                <StackPanel Margin="4" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <Button Content="Allowable DFU" Width="140" Click="BtnVentAllowable_Click" />
                                    <TextBlock Text="Needs vent size + length; outputs allowable DFU." Margin="8,0,0,0" FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" VerticalAlignment="Center" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Allowable DFU" />
                                    <TextBox Name="VentAllowableOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                        </StackPanel>
                    </Border>

                    <Border x:Name="StormwaterCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource HighlightBorderStyle}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Stormwater" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter roof area, rainfall, slope, and roughness. Step 2: Run storm sizing and partial-flow checks. Step 3: Check leaders." />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Margin="0,0,0,4"
                                       Text="Enter roof area, rainfall, slope, and Manning n, then run the storm calculations to size drains, partial-flow segments, and leaders." />
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Roof/Area (ft²)" />
                                    <TextBox Name="StormAreaInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Rainfall Intensity (in/hr)" />
                                    <TextBox Name="StormRainfallInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Slope (ft/ft)" />
                                    <TextBox Name="StormSlopeInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Manning n" />
                                    <TextBox Name="StormRoughnessInput" />
                                </StackPanel>
                            </UniformGrid>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,8">
                                <Button Content="Calc Storm Size" Width="160" Click="BtnStormSize_Click" />
                                <Button Content="Partial Flow Size" Width="160" Margin="8,0,0,0" Click="BtnStormPartialSize_Click" />
                            </StackPanel>
                            <UniformGrid Columns="3" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Storm Flow (gpm)" />
                                    <TextBox Name="StormFlowOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Required Diameter (in)" />
                                    <TextBox Name="StormDiameterOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Partial Depth Ratio (y/D)" />
                                    <TextBox Name="StormDepthRatioInput" />
                                </StackPanel>
                            </UniformGrid>
                            <UniformGrid Columns="3" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Partial-Flow Dia (in)" />
                                    <TextBox Name="StormPartialDiameterOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
    
                            <UniformGrid Columns="3" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Leader Flow (gpm)" />
                                    <TextBox Name="StormLeaderFlowInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Leader Dia (in)" />
                                    <TextBox Name="StormLeaderDiameterInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <Button Content="Check Leader" Width="140" Click="BtnStormLeaderCheck_Click" />
                                </StackPanel>
                            </UniformGrid>
                            <UniformGrid Columns="3" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Leader Capacity (gpm)" />
                                    <TextBox Name="StormLeaderCapacityOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Sized Leader Dia (in)" />
                                    <TextBox Name="StormLeaderSizedOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                            <TextBlock Name="StormNote" Margin="4,0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>
    
                    <Border x:Name="GasCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource WarningBorderStyle}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Natural Gas (IFGC/NFPA 54)" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter load, length, pressure drop, and properties. Step 2: Size gas. Step 3: Review diameter, flow, and velocity." />
                            <UniformGrid Columns="5" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Load (MBH)" />
                                    <TextBox Name="GasLoadInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Length (ft)" />
                                    <TextBox Name="GasLengthInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="ΔP (in. w.c.)" />
                                    <TextBox Name="GasPressureDropInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Specific Gravity" />
                                    <TextBox Name="GasSpecificGravityInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Base Pressure (psi)" />
                                    <TextBox Name="GasBasePressureInput" />
                                </StackPanel>
                            </UniformGrid>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,8">
                                <Button Content="Size Gas" Width="140" Click="BtnGasSize_Click" />
                            </StackPanel>
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Required Dia (in)" />
                                    <TextBox Name="GasDiameterOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Flow (scfh)" />
                                    <TextBox Name="GasFlowOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Velocity (ft/s)" />
                                    <TextBox Name="GasVelocityOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                            <TextBlock Name="GasNote" Margin="4,0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>
    
                    <Border x:Name="RecircCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource CardBorderStyle}" Background="{StaticResource Brush.SurfaceAlt}" BorderBrush="{StaticResource Brush.BorderMuted}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="DHW Recirculation" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter loop volume, turnover, and heat loss. Step 2: Add pipe and fitting lengths. Step 3: Calculate recirculation flow and head." />
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Loop Volume (gal)" />
                                    <TextBox Name="RecircVolumeInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Turnover (min)" />
                                    <TextBox Name="RecircTurnoverInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Heat Loss (Btuh)" />
                                    <TextBox Name="RecircHeatLossInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Allowed ΔT (°F)" />
                                    <TextBox Name="RecircDeltaTInput" />
                                </StackPanel>
                            </UniformGrid>
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Recirc Dia (in)" />
                                    <TextBox Name="RecircDiaInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="C-factor" />
                                    <TextBox Name="RecircCInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Run Length (ft)" />
                                    <TextBox Name="RecircLengthInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Fitting Eq. Length (ft)" />
                                    <TextBox Name="RecircEqLengthInput" />
                                </StackPanel>
                            </UniformGrid>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,8">
                                <Button Content="Calc Recirc" Width="140" Click="BtnRecircCalc_Click" />
                            </StackPanel>
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Recirc Flow (gpm)" />
                                    <TextBox Name="RecircFlowOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Recirc Head (ft)" />
                                    <TextBox Name="RecircHeadOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Recirc Head (psi)" />
                                    <TextBox Name="RecircHeadPsiOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                            <TextBlock Name="RecircNote" Margin="4,0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>
    
                    <Border x:Name="HammerCard" Margin="0,0,0,10" Padding="12" Style="{StaticResource WarningBorderStyle}" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="Water Hammer Check" FontWeight="Bold" FontSize="14" />
                            <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" Margin="0,2,0,8"
                                       Text="Step 1: Enter line velocity and length. Step 2: Add closure time and static pressure. Step 3: Check surge and total pressure." />
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Line Velocity (ft/s)" />
                                    <TextBox Name="HammerVelocityInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Line Length (ft)" />
                                    <TextBox Name="HammerLengthInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Closure Time (s)" />
                                    <TextBox Name="HammerClosureInput" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Static Pressure (psi)" />
                                    <TextBox Name="HammerStaticInput" />
                                </StackPanel>
                            </UniformGrid>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,8">
                                <Button Content="Check Hammer" Width="140" Click="BtnHammerCalc_Click" />
                            </StackPanel>
                            <UniformGrid Columns="4" Margin="0,4">
                                <StackPanel Margin="4">
                                    <TextBlock Text="Wave Speed (ft/s)" />
                                    <TextBox Name="HammerWaveSpeedOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Surge (psi)" />
                                    <TextBox Name="HammerSurgeOutput" IsReadOnly="True" />
                                </StackPanel>
                                <StackPanel Margin="4">
                                    <TextBlock Text="Total Pressure (psi)" />
                                    <TextBox Name="HammerTotalOutput" IsReadOnly="True" />
                                </StackPanel>
                            </UniformGrid>
                            <TextBlock Name="HammerNote" Margin="4,0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </TabItem>

            <TabItem x:Name="CatalogTab" Header="Catalogs &amp; data">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="12" Orientation="Vertical">
                        <TextBlock Text="Use built-in tables or point to a custom folder; built-ins stay active unless a valid catalog is loaded." TextWrapping="Wrap" />
                        <Border Padding="10" Style="{StaticResource AccentBorderStyle}">
                            <StackPanel Orientation="Vertical">
                                <TextBlock Text="Custom catalog folder" FontWeight="Bold" />
                                <TextBlock TextWrapping="Wrap" FontSize="12" Text="Point to a folder containing materials.json/materials.csv and fittings.json/fittings.csv. Runtime files merge with the built-in ASHRAE/SMACNA/ASPE tables; invalid or missing files keep the defaults. Templates are auto-detected even if they are still named materials-template/fittings-template." />
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,2,0,0">
                                    <TextBox Name="CatalogFolderText" Width="420" Margin="0,0,6,0" />
                                    <Button Content="Browse" Width="80" Margin="0,0,6,0" Click="BrowseCatalogFolder_Click" Style="{StaticResource BaseButtonStyle}" />
                                    <Button Content="Reload Catalogs" Width="130" Click="ReloadCatalogs_Click" Style="{StaticResource BaseButtonStyle}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <Button Content="Reset to built-ins" Width="140" Click="ResetCatalogs_Click" Margin="0,0,8,0" />
                                    <Button Content="Create template files" Width="170" Click="CreateCatalogTemplates_Click" Margin="0,0,8,0" />
                                    <Button Content="Open catalog folder" Width="160" Click="OpenCatalogFolder_Click" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Border Name="CatalogStatusBadge" Style="{StaticResource BadgeBorderStyle}" Background="{StaticResource Brush.ChipInfoBackground}" BorderBrush="{StaticResource Brush.ChipInfoBorder}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Name="CatalogStatusIcon" FontWeight="Bold" Margin="0,0,6,0" Text="ℹ" />
                                            <TextBlock Name="CatalogStatusTitle" FontWeight="SemiBold" Text="Catalog status" />
                                        </StackPanel>
                                    </Border>
                                    <TextBlock Name="CatalogStatusNote" TextWrapping="Wrap" Width="580" />
                                </StackPanel>
                                <TextBlock Name="CatalogHelperText" TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource Brush.TextSubtle}" />

                                <UniformGrid Columns="2" Margin="0,8,0,0">
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock Text="Detected catalog files" FontWeight="SemiBold" />
                                        <TextBlock Text="Helps verify the folder you picked has the right files and timestamps." FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" />
                                        <ListBox ItemsSource="{Binding CatalogFiles}" Height="120" Margin="0,4,0,0" />
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock Text="Loaded catalog preview" FontWeight="SemiBold" />
                                        <TextBlock Text="Shows what actually loaded into the app after validation." FontSize="11" Foreground="{StaticResource Brush.TextSubtle}" />
                                        <ListBox ItemsSource="{Binding CatalogPreview}" Height="120" Margin="0,4,0,0" />
                                    </StackPanel>
                                </UniformGrid>

                                <UniformGrid Columns="2" Margin="0,6,0,0">
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock Text="Warnings" FontWeight="SemiBold" />
                                        <ItemsControl ItemsSource="{Binding CatalogWarnings}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                        <TextBlock Text="⚠" Margin="0,0,6,0" />
                                                        <TextBlock Text="{Binding}" TextWrapping="Wrap" Width="260" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock Text="Errors" FontWeight="SemiBold" />
                                        <ItemsControl ItemsSource="{Binding CatalogErrors}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                        <TextBlock Text="⛔" Margin="0,0,6,0" />
                                                        <TextBlock Text="{Binding}" TextWrapping="Wrap" Width="260" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </UniformGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
